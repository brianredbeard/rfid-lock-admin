<!doctype html PUBLIC "-//W3C//DTD html 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
    
    
    <meta http-equiv='X-UA-Compatible' content='IE=emulateIE7' />
    <title>Coverage for djock_app/admin: 100%</title>
    <link rel='stylesheet' href='style.css' type='text/css'>
    
    <script type='text/javascript' src='jquery-1.4.3.min.js'></script>
    <script type='text/javascript' src='jquery.hotkeys.js'></script>
    <script type='text/javascript' src='jquery.isonscreen.js'></script>
    <script type='text/javascript' src='coverage_html.js'></script>
    <script type='text/javascript' charset='utf-8'>
        jQuery(document).ready(coverage.pyfile_ready);
    </script>
</head>
<body id='pyfile'>

<div id='header'>
    <div class='content'>
        <h1>Coverage for <b>djock_app/admin</b> :
            <span class='pc_cov'>100%</span>
        </h1>
        <img id='keyboard_icon' src='keybd_closed.png'>
        <h2 class='stats'>
            127 statements &nbsp;
            <span class='run hide_run shortkey_r button_toggle_run'>127 run</span>
            <span class='mis shortkey_m button_toggle_mis'>0 missing</span>
            <span class='exc shortkey_x button_toggle_exc'>4 excluded</span>
            
        </h2>
    </div>
</div>

<div class='help_panel'>
    <img id='panel_icon' src='keybd_open.png'>
<p class='legend'>Hot-keys on this page</p>
    <div>
<p class='keyhelp'>
        <span class='key'>r</span>
        <span class='key'>m</span>
        <span class='key'>x</span>
        <span class='key'>p</span> &nbsp; toggle line displays
    </p>
<p class='keyhelp'>
        <span class='key'>j</span>
        <span class='key'>k</span> &nbsp; next/prev highlighted chunk
    </p>
<p class='keyhelp'>
        <span class='key'>0</span> &nbsp; (zero) top of page
    </p>
<p class='keyhelp'>
        <span class='key'>1</span> &nbsp; (one) first highlighted chunk
    </p>
    </div>
</div>

<div id='source'>
    <table cellspacing='0' cellpadding='0'>
        <tr>
            <td class='linenos' valign='top'>
<p id='n1' class='stm run hide_run'><a href='#n1'>1</a></p>
<p id='n2' class='stm run hide_run'><a href='#n2'>2</a></p>
<p id='n3' class='stm run hide_run'><a href='#n3'>3</a></p>
<p id='n4' class='stm run hide_run'><a href='#n4'>4</a></p>
<p id='n5' class='stm run hide_run'><a href='#n5'>5</a></p>
<p id='n6' class='stm run hide_run'><a href='#n6'>6</a></p>
<p id='n7' class='stm run hide_run'><a href='#n7'>7</a></p>
<p id='n8' class='pln'><a href='#n8'>8</a></p>
<p id='n9' class='pln'><a href='#n9'>9</a></p>
<p id='n10' class='pln'><a href='#n10'>10</a></p>
<p id='n11' class='pln'><a href='#n11'>11</a></p>
<p id='n12' class='pln'><a href='#n12'>12</a></p>
<p id='n13' class='pln'><a href='#n13'>13</a></p>
<p id='n14' class='pln'><a href='#n14'>14</a></p>
<p id='n15' class='pln'><a href='#n15'>15</a></p>
<p id='n16' class='pln'><a href='#n16'>16</a></p>
<p id='n17' class='pln'><a href='#n17'>17</a></p>
<p id='n18' class='pln'><a href='#n18'>18</a></p>
<p id='n19' class='pln'><a href='#n19'>19</a></p>
<p id='n20' class='pln'><a href='#n20'>20</a></p>
<p id='n21' class='pln'><a href='#n21'>21</a></p>
<p id='n22' class='pln'><a href='#n22'>22</a></p>
<p id='n23' class='pln'><a href='#n23'>23</a></p>
<p id='n24' class='pln'><a href='#n24'>24</a></p>
<p id='n25' class='pln'><a href='#n25'>25</a></p>
<p id='n26' class='pln'><a href='#n26'>26</a></p>
<p id='n27' class='pln'><a href='#n27'>27</a></p>
<p id='n28' class='pln'><a href='#n28'>28</a></p>
<p id='n29' class='pln'><a href='#n29'>29</a></p>
<p id='n30' class='pln'><a href='#n30'>30</a></p>
<p id='n31' class='pln'><a href='#n31'>31</a></p>
<p id='n32' class='pln'><a href='#n32'>32</a></p>
<p id='n33' class='pln'><a href='#n33'>33</a></p>
<p id='n34' class='pln'><a href='#n34'>34</a></p>
<p id='n35' class='pln'><a href='#n35'>35</a></p>
<p id='n36' class='pln'><a href='#n36'>36</a></p>
<p id='n37' class='pln'><a href='#n37'>37</a></p>
<p id='n38' class='pln'><a href='#n38'>38</a></p>
<p id='n39' class='pln'><a href='#n39'>39</a></p>
<p id='n40' class='pln'><a href='#n40'>40</a></p>
<p id='n41' class='pln'><a href='#n41'>41</a></p>
<p id='n42' class='pln'><a href='#n42'>42</a></p>
<p id='n43' class='pln'><a href='#n43'>43</a></p>
<p id='n44' class='pln'><a href='#n44'>44</a></p>
<p id='n45' class='pln'><a href='#n45'>45</a></p>
<p id='n46' class='pln'><a href='#n46'>46</a></p>
<p id='n47' class='pln'><a href='#n47'>47</a></p>
<p id='n48' class='pln'><a href='#n48'>48</a></p>
<p id='n49' class='pln'><a href='#n49'>49</a></p>
<p id='n50' class='pln'><a href='#n50'>50</a></p>
<p id='n51' class='pln'><a href='#n51'>51</a></p>
<p id='n52' class='pln'><a href='#n52'>52</a></p>
<p id='n53' class='pln'><a href='#n53'>53</a></p>
<p id='n54' class='pln'><a href='#n54'>54</a></p>
<p id='n55' class='pln'><a href='#n55'>55</a></p>
<p id='n56' class='pln'><a href='#n56'>56</a></p>
<p id='n57' class='pln'><a href='#n57'>57</a></p>
<p id='n58' class='pln'><a href='#n58'>58</a></p>
<p id='n59' class='pln'><a href='#n59'>59</a></p>
<p id='n60' class='pln'><a href='#n60'>60</a></p>
<p id='n61' class='pln'><a href='#n61'>61</a></p>
<p id='n62' class='pln'><a href='#n62'>62</a></p>
<p id='n63' class='pln'><a href='#n63'>63</a></p>
<p id='n64' class='pln'><a href='#n64'>64</a></p>
<p id='n65' class='pln'><a href='#n65'>65</a></p>
<p id='n66' class='pln'><a href='#n66'>66</a></p>
<p id='n67' class='pln'><a href='#n67'>67</a></p>
<p id='n68' class='pln'><a href='#n68'>68</a></p>
<p id='n69' class='pln'><a href='#n69'>69</a></p>
<p id='n70' class='pln'><a href='#n70'>70</a></p>
<p id='n71' class='pln'><a href='#n71'>71</a></p>
<p id='n72' class='pln'><a href='#n72'>72</a></p>
<p id='n73' class='pln'><a href='#n73'>73</a></p>
<p id='n74' class='pln'><a href='#n74'>74</a></p>
<p id='n75' class='pln'><a href='#n75'>75</a></p>
<p id='n76' class='pln'><a href='#n76'>76</a></p>
<p id='n77' class='pln'><a href='#n77'>77</a></p>
<p id='n78' class='pln'><a href='#n78'>78</a></p>
<p id='n79' class='pln'><a href='#n79'>79</a></p>
<p id='n80' class='pln'><a href='#n80'>80</a></p>
<p id='n81' class='pln'><a href='#n81'>81</a></p>
<p id='n82' class='pln'><a href='#n82'>82</a></p>
<p id='n83' class='pln'><a href='#n83'>83</a></p>
<p id='n84' class='pln'><a href='#n84'>84</a></p>
<p id='n85' class='pln'><a href='#n85'>85</a></p>
<p id='n86' class='pln'><a href='#n86'>86</a></p>
<p id='n87' class='pln'><a href='#n87'>87</a></p>
<p id='n88' class='pln'><a href='#n88'>88</a></p>
<p id='n89' class='pln'><a href='#n89'>89</a></p>
<p id='n90' class='pln'><a href='#n90'>90</a></p>
<p id='n91' class='pln'><a href='#n91'>91</a></p>
<p id='n92' class='pln'><a href='#n92'>92</a></p>
<p id='n93' class='pln'><a href='#n93'>93</a></p>
<p id='n94' class='pln'><a href='#n94'>94</a></p>
<p id='n95' class='pln'><a href='#n95'>95</a></p>
<p id='n96' class='pln'><a href='#n96'>96</a></p>
<p id='n97' class='pln'><a href='#n97'>97</a></p>
<p id='n98' class='pln'><a href='#n98'>98</a></p>
<p id='n99' class='pln'><a href='#n99'>99</a></p>
<p id='n100' class='pln'><a href='#n100'>100</a></p>
<p id='n101' class='pln'><a href='#n101'>101</a></p>
<p id='n102' class='pln'><a href='#n102'>102</a></p>
<p id='n103' class='pln'><a href='#n103'>103</a></p>
<p id='n104' class='pln'><a href='#n104'>104</a></p>
<p id='n105' class='pln'><a href='#n105'>105</a></p>
<p id='n106' class='pln'><a href='#n106'>106</a></p>
<p id='n107' class='pln'><a href='#n107'>107</a></p>
<p id='n108' class='pln'><a href='#n108'>108</a></p>
<p id='n109' class='pln'><a href='#n109'>109</a></p>
<p id='n110' class='pln'><a href='#n110'>110</a></p>
<p id='n111' class='pln'><a href='#n111'>111</a></p>
<p id='n112' class='pln'><a href='#n112'>112</a></p>
<p id='n113' class='pln'><a href='#n113'>113</a></p>
<p id='n114' class='pln'><a href='#n114'>114</a></p>
<p id='n115' class='pln'><a href='#n115'>115</a></p>
<p id='n116' class='pln'><a href='#n116'>116</a></p>
<p id='n117' class='pln'><a href='#n117'>117</a></p>
<p id='n118' class='pln'><a href='#n118'>118</a></p>
<p id='n119' class='pln'><a href='#n119'>119</a></p>
<p id='n120' class='pln'><a href='#n120'>120</a></p>
<p id='n121' class='pln'><a href='#n121'>121</a></p>
<p id='n122' class='pln'><a href='#n122'>122</a></p>
<p id='n123' class='pln'><a href='#n123'>123</a></p>
<p id='n124' class='pln'><a href='#n124'>124</a></p>
<p id='n125' class='pln'><a href='#n125'>125</a></p>
<p id='n126' class='pln'><a href='#n126'>126</a></p>
<p id='n127' class='pln'><a href='#n127'>127</a></p>
<p id='n128' class='pln'><a href='#n128'>128</a></p>
<p id='n129' class='pln'><a href='#n129'>129</a></p>
<p id='n130' class='pln'><a href='#n130'>130</a></p>
<p id='n131' class='pln'><a href='#n131'>131</a></p>
<p id='n132' class='pln'><a href='#n132'>132</a></p>
<p id='n133' class='pln'><a href='#n133'>133</a></p>
<p id='n134' class='pln'><a href='#n134'>134</a></p>
<p id='n135' class='pln'><a href='#n135'>135</a></p>
<p id='n136' class='pln'><a href='#n136'>136</a></p>
<p id='n137' class='pln'><a href='#n137'>137</a></p>
<p id='n138' class='pln'><a href='#n138'>138</a></p>
<p id='n139' class='pln'><a href='#n139'>139</a></p>
<p id='n140' class='pln'><a href='#n140'>140</a></p>
<p id='n141' class='pln'><a href='#n141'>141</a></p>
<p id='n142' class='pln'><a href='#n142'>142</a></p>
<p id='n143' class='pln'><a href='#n143'>143</a></p>
<p id='n144' class='pln'><a href='#n144'>144</a></p>
<p id='n145' class='pln'><a href='#n145'>145</a></p>
<p id='n146' class='pln'><a href='#n146'>146</a></p>
<p id='n147' class='stm run hide_run'><a href='#n147'>147</a></p>
<p id='n148' class='stm run hide_run'><a href='#n148'>148</a></p>
<p id='n149' class='stm run hide_run'><a href='#n149'>149</a></p>
<p id='n150' class='pln'><a href='#n150'>150</a></p>
<p id='n151' class='stm run hide_run'><a href='#n151'>151</a></p>
<p id='n152' class='stm run hide_run'><a href='#n152'>152</a></p>
<p id='n153' class='stm run hide_run'><a href='#n153'>153</a></p>
<p id='n154' class='stm run hide_run'><a href='#n154'>154</a></p>
<p id='n155' class='pln'><a href='#n155'>155</a></p>
<p id='n156' class='stm run hide_run'><a href='#n156'>156</a></p>
<p id='n157' class='pln'><a href='#n157'>157</a></p>
<p id='n158' class='pln'><a href='#n158'>158</a></p>
<p id='n159' class='stm run hide_run'><a href='#n159'>159</a></p>
<p id='n160' class='pln'><a href='#n160'>160</a></p>
<p id='n161' class='pln'><a href='#n161'>161</a></p>
<p id='n162' class='pln'><a href='#n162'>162</a></p>
<p id='n163' class='pln'><a href='#n163'>163</a></p>
<p id='n164' class='pln'><a href='#n164'>164</a></p>
<p id='n165' class='stm run hide_run'><a href='#n165'>165</a></p>
<p id='n166' class='pln'><a href='#n166'>166</a></p>
<p id='n167' class='stm run hide_run'><a href='#n167'>167</a></p>
<p id='n168' class='pln'><a href='#n168'>168</a></p>
<p id='n169' class='stm run hide_run'><a href='#n169'>169</a></p>
<p id='n170' class='pln'><a href='#n170'>170</a></p>
<p id='n171' class='pln'><a href='#n171'>171</a></p>
<p id='n172' class='pln'><a href='#n172'>172</a></p>
<p id='n173' class='pln'><a href='#n173'>173</a></p>
<p id='n174' class='stm run hide_run'><a href='#n174'>174</a></p>
<p id='n175' class='pln'><a href='#n175'>175</a></p>
<p id='n176' class='pln'><a href='#n176'>176</a></p>
<p id='n177' class='pln'><a href='#n177'>177</a></p>
<p id='n178' class='stm run hide_run'><a href='#n178'>178</a></p>
<p id='n179' class='stm run hide_run'><a href='#n179'>179</a></p>
<p id='n180' class='pln'><a href='#n180'>180</a></p>
<p id='n181' class='stm run hide_run'><a href='#n181'>181</a></p>
<p id='n182' class='pln'><a href='#n182'>182</a></p>
<p id='n183' class='pln'><a href='#n183'>183</a></p>
<p id='n184' class='pln'><a href='#n184'>184</a></p>
<p id='n185' class='stm run hide_run'><a href='#n185'>185</a></p>
<p id='n186' class='pln'><a href='#n186'>186</a></p>
<p id='n187' class='stm run hide_run'><a href='#n187'>187</a></p>
<p id='n188' class='pln'><a href='#n188'>188</a></p>
<p id='n189' class='stm run hide_run'><a href='#n189'>189</a></p>
<p id='n190' class='stm run hide_run'><a href='#n190'>190</a></p>
<p id='n191' class='stm run hide_run'><a href='#n191'>191</a></p>
<p id='n192' class='stm run hide_run'><a href='#n192'>192</a></p>
<p id='n193' class='pln'><a href='#n193'>193</a></p>
<p id='n194' class='stm run hide_run'><a href='#n194'>194</a></p>
<p id='n195' class='pln'><a href='#n195'>195</a></p>
<p id='n196' class='pln'><a href='#n196'>196</a></p>
<p id='n197' class='stm run hide_run'><a href='#n197'>197</a></p>
<p id='n198' class='pln'><a href='#n198'>198</a></p>
<p id='n199' class='pln'><a href='#n199'>199</a></p>
<p id='n200' class='pln'><a href='#n200'>200</a></p>
<p id='n201' class='pln'><a href='#n201'>201</a></p>
<p id='n202' class='pln'><a href='#n202'>202</a></p>
<p id='n203' class='stm run hide_run'><a href='#n203'>203</a></p>
<p id='n204' class='pln'><a href='#n204'>204</a></p>
<p id='n205' class='pln'><a href='#n205'>205</a></p>
<p id='n206' class='stm run hide_run'><a href='#n206'>206</a></p>
<p id='n207' class='stm run hide_run'><a href='#n207'>207</a></p>
<p id='n208' class='stm run hide_run'><a href='#n208'>208</a></p>
<p id='n209' class='stm run hide_run'><a href='#n209'>209</a></p>
<p id='n210' class='stm run hide_run'><a href='#n210'>210</a></p>
<p id='n211' class='pln'><a href='#n211'>211</a></p>
<p id='n212' class='pln'><a href='#n212'>212</a></p>
<p id='n213' class='stm run hide_run'><a href='#n213'>213</a></p>
<p id='n214' class='stm run hide_run'><a href='#n214'>214</a></p>
<p id='n215' class='stm run hide_run'><a href='#n215'>215</a></p>
<p id='n216' class='stm run hide_run'><a href='#n216'>216</a></p>
<p id='n217' class='pln'><a href='#n217'>217</a></p>
<p id='n218' class='pln'><a href='#n218'>218</a></p>
<p id='n219' class='pln'><a href='#n219'>219</a></p>
<p id='n220' class='pln'><a href='#n220'>220</a></p>
<p id='n221' class='pln'><a href='#n221'>221</a></p>
<p id='n222' class='pln'><a href='#n222'>222</a></p>
<p id='n223' class='pln'><a href='#n223'>223</a></p>
<p id='n224' class='pln'><a href='#n224'>224</a></p>
<p id='n225' class='pln'><a href='#n225'>225</a></p>
<p id='n226' class='pln'><a href='#n226'>226</a></p>
<p id='n227' class='stm run hide_run'><a href='#n227'>227</a></p>
<p id='n228' class='pln'><a href='#n228'>228</a></p>
<p id='n229' class='stm run hide_run'><a href='#n229'>229</a></p>
<p id='n230' class='stm run hide_run'><a href='#n230'>230</a></p>
<p id='n231' class='stm run hide_run'><a href='#n231'>231</a></p>
<p id='n232' class='stm run hide_run'><a href='#n232'>232</a></p>
<p id='n233' class='stm run hide_run'><a href='#n233'>233</a></p>
<p id='n234' class='stm run hide_run'><a href='#n234'>234</a></p>
<p id='n235' class='stm run hide_run'><a href='#n235'>235</a></p>
<p id='n236' class='pln'><a href='#n236'>236</a></p>
<p id='n237' class='pln'><a href='#n237'>237</a></p>
<p id='n238' class='pln'><a href='#n238'>238</a></p>
<p id='n239' class='pln'><a href='#n239'>239</a></p>
<p id='n240' class='pln'><a href='#n240'>240</a></p>
<p id='n241' class='pln'><a href='#n241'>241</a></p>
<p id='n242' class='pln'><a href='#n242'>242</a></p>
<p id='n243' class='stm run hide_run'><a href='#n243'>243</a></p>
<p id='n244' class='pln'><a href='#n244'>244</a></p>
<p id='n245' class='pln'><a href='#n245'>245</a></p>
<p id='n246' class='stm run hide_run'><a href='#n246'>246</a></p>
<p id='n247' class='pln'><a href='#n247'>247</a></p>
<p id='n248' class='pln'><a href='#n248'>248</a></p>
<p id='n249' class='pln'><a href='#n249'>249</a></p>
<p id='n250' class='stm run hide_run'><a href='#n250'>250</a></p>
<p id='n251' class='pln'><a href='#n251'>251</a></p>
<p id='n252' class='pln'><a href='#n252'>252</a></p>
<p id='n253' class='pln'><a href='#n253'>253</a></p>
<p id='n254' class='pln'><a href='#n254'>254</a></p>
<p id='n255' class='pln'><a href='#n255'>255</a></p>
<p id='n256' class='pln'><a href='#n256'>256</a></p>
<p id='n257' class='pln'><a href='#n257'>257</a></p>
<p id='n258' class='stm run hide_run'><a href='#n258'>258</a></p>
<p id='n259' class='pln'><a href='#n259'>259</a></p>
<p id='n260' class='pln'><a href='#n260'>260</a></p>
<p id='n261' class='pln'><a href='#n261'>261</a></p>
<p id='n262' class='pln'><a href='#n262'>262</a></p>
<p id='n263' class='pln'><a href='#n263'>263</a></p>
<p id='n264' class='pln'><a href='#n264'>264</a></p>
<p id='n265' class='pln'><a href='#n265'>265</a></p>
<p id='n266' class='pln'><a href='#n266'>266</a></p>
<p id='n267' class='stm run hide_run'><a href='#n267'>267</a></p>
<p id='n268' class='pln'><a href='#n268'>268</a></p>
<p id='n269' class='stm run hide_run'><a href='#n269'>269</a></p>
<p id='n270' class='pln'><a href='#n270'>270</a></p>
<p id='n271' class='pln'><a href='#n271'>271</a></p>
<p id='n272' class='pln'><a href='#n272'>272</a></p>
<p id='n273' class='pln'><a href='#n273'>273</a></p>
<p id='n274' class='pln'><a href='#n274'>274</a></p>
<p id='n275' class='pln'><a href='#n275'>275</a></p>
<p id='n276' class='pln'><a href='#n276'>276</a></p>
<p id='n277' class='pln'><a href='#n277'>277</a></p>
<p id='n278' class='pln'><a href='#n278'>278</a></p>
<p id='n279' class='pln'><a href='#n279'>279</a></p>
<p id='n280' class='stm run hide_run'><a href='#n280'>280</a></p>
<p id='n281' class='stm run hide_run'><a href='#n281'>281</a></p>
<p id='n282' class='stm run hide_run'><a href='#n282'>282</a></p>
<p id='n283' class='pln'><a href='#n283'>283</a></p>
<p id='n284' class='stm run hide_run'><a href='#n284'>284</a></p>
<p id='n285' class='stm run hide_run'><a href='#n285'>285</a></p>
<p id='n286' class='pln'><a href='#n286'>286</a></p>
<p id='n287' class='stm run hide_run'><a href='#n287'>287</a></p>
<p id='n288' class='pln'><a href='#n288'>288</a></p>
<p id='n289' class='stm run hide_run'><a href='#n289'>289</a></p>
<p id='n290' class='stm run hide_run'><a href='#n290'>290</a></p>
<p id='n291' class='stm run hide_run'><a href='#n291'>291</a></p>
<p id='n292' class='pln'><a href='#n292'>292</a></p>
<p id='n293' class='pln'><a href='#n293'>293</a></p>
<p id='n294' class='pln'><a href='#n294'>294</a></p>
<p id='n295' class='pln'><a href='#n295'>295</a></p>
<p id='n296' class='pln'><a href='#n296'>296</a></p>
<p id='n297' class='stm run hide_run'><a href='#n297'>297</a></p>
<p id='n298' class='pln'><a href='#n298'>298</a></p>
<p id='n299' class='pln'><a href='#n299'>299</a></p>
<p id='n300' class='pln'><a href='#n300'>300</a></p>
<p id='n301' class='pln'><a href='#n301'>301</a></p>
<p id='n302' class='pln'><a href='#n302'>302</a></p>
<p id='n303' class='pln'><a href='#n303'>303</a></p>
<p id='n304' class='pln'><a href='#n304'>304</a></p>
<p id='n305' class='pln'><a href='#n305'>305</a></p>
<p id='n306' class='stm run hide_run'><a href='#n306'>306</a></p>
<p id='n307' class='pln'><a href='#n307'>307</a></p>
<p id='n308' class='pln'><a href='#n308'>308</a></p>
<p id='n309' class='pln'><a href='#n309'>309</a></p>
<p id='n310' class='pln'><a href='#n310'>310</a></p>
<p id='n311' class='pln'><a href='#n311'>311</a></p>
<p id='n312' class='pln'><a href='#n312'>312</a></p>
<p id='n313' class='pln'><a href='#n313'>313</a></p>
<p id='n314' class='pln'><a href='#n314'>314</a></p>
<p id='n315' class='pln'><a href='#n315'>315</a></p>
<p id='n316' class='pln'><a href='#n316'>316</a></p>
<p id='n317' class='pln'><a href='#n317'>317</a></p>
<p id='n318' class='pln'><a href='#n318'>318</a></p>
<p id='n319' class='pln'><a href='#n319'>319</a></p>
<p id='n320' class='pln'><a href='#n320'>320</a></p>
<p id='n321' class='pln'><a href='#n321'>321</a></p>
<p id='n322' class='pln'><a href='#n322'>322</a></p>
<p id='n323' class='pln'><a href='#n323'>323</a></p>
<p id='n324' class='pln'><a href='#n324'>324</a></p>
<p id='n325' class='pln'><a href='#n325'>325</a></p>
<p id='n326' class='pln'><a href='#n326'>326</a></p>
<p id='n327' class='pln'><a href='#n327'>327</a></p>
<p id='n328' class='stm run hide_run'><a href='#n328'>328</a></p>
<p id='n329' class='pln'><a href='#n329'>329</a></p>
<p id='n330' class='pln'><a href='#n330'>330</a></p>
<p id='n331' class='pln'><a href='#n331'>331</a></p>
<p id='n332' class='pln'><a href='#n332'>332</a></p>
<p id='n333' class='pln'><a href='#n333'>333</a></p>
<p id='n334' class='stm run hide_run'><a href='#n334'>334</a></p>
<p id='n335' class='pln'><a href='#n335'>335</a></p>
<p id='n336' class='pln'><a href='#n336'>336</a></p>
<p id='n337' class='exc'><a href='#n337'>337</a></p>
<p id='n338' class='exc'><a href='#n338'>338</a></p>
<p id='n339' class='pln'><a href='#n339'>339</a></p>
<p id='n340' class='stm run hide_run'><a href='#n340'>340</a></p>
<p id='n341' class='stm run hide_run'><a href='#n341'>341</a></p>
<p id='n342' class='stm run hide_run'><a href='#n342'>342</a></p>
<p id='n343' class='stm run hide_run'><a href='#n343'>343</a></p>
<p id='n344' class='stm run hide_run'><a href='#n344'>344</a></p>
<p id='n345' class='stm run hide_run'><a href='#n345'>345</a></p>
<p id='n346' class='pln'><a href='#n346'>346</a></p>
<p id='n347' class='pln'><a href='#n347'>347</a></p>
<p id='n348' class='stm run hide_run'><a href='#n348'>348</a></p>
<p id='n349' class='pln'><a href='#n349'>349</a></p>
<p id='n350' class='pln'><a href='#n350'>350</a></p>
<p id='n351' class='pln'><a href='#n351'>351</a></p>
<p id='n352' class='pln'><a href='#n352'>352</a></p>
<p id='n353' class='pln'><a href='#n353'>353</a></p>
<p id='n354' class='pln'><a href='#n354'>354</a></p>
<p id='n355' class='pln'><a href='#n355'>355</a></p>
<p id='n356' class='pln'><a href='#n356'>356</a></p>
<p id='n357' class='pln'><a href='#n357'>357</a></p>
<p id='n358' class='stm run hide_run'><a href='#n358'>358</a></p>
<p id='n359' class='pln'><a href='#n359'>359</a></p>
<p id='n360' class='pln'><a href='#n360'>360</a></p>
<p id='n361' class='pln'><a href='#n361'>361</a></p>
<p id='n362' class='exc'><a href='#n362'>362</a></p>
<p id='n363' class='exc'><a href='#n363'>363</a></p>
<p id='n364' class='pln'><a href='#n364'>364</a></p>
<p id='n365' class='stm run hide_run'><a href='#n365'>365</a></p>
<p id='n366' class='stm run hide_run'><a href='#n366'>366</a></p>
<p id='n367' class='stm run hide_run'><a href='#n367'>367</a></p>
<p id='n368' class='pln'><a href='#n368'>368</a></p>
<p id='n369' class='stm run hide_run'><a href='#n369'>369</a></p>
<p id='n370' class='stm run hide_run'><a href='#n370'>370</a></p>
<p id='n371' class='pln'><a href='#n371'>371</a></p>
<p id='n372' class='stm run hide_run'><a href='#n372'>372</a></p>
<p id='n373' class='pln'><a href='#n373'>373</a></p>
<p id='n374' class='pln'><a href='#n374'>374</a></p>
<p id='n375' class='pln'><a href='#n375'>375</a></p>
<p id='n376' class='stm run hide_run'><a href='#n376'>376</a></p>
<p id='n377' class='pln'><a href='#n377'>377</a></p>
<p id='n378' class='pln'><a href='#n378'>378</a></p>
<p id='n379' class='pln'><a href='#n379'>379</a></p>
<p id='n380' class='pln'><a href='#n380'>380</a></p>
<p id='n381' class='pln'><a href='#n381'>381</a></p>
<p id='n382' class='pln'><a href='#n382'>382</a></p>
<p id='n383' class='pln'><a href='#n383'>383</a></p>
<p id='n384' class='pln'><a href='#n384'>384</a></p>
<p id='n385' class='pln'><a href='#n385'>385</a></p>
<p id='n386' class='pln'><a href='#n386'>386</a></p>
<p id='n387' class='pln'><a href='#n387'>387</a></p>
<p id='n388' class='pln'><a href='#n388'>388</a></p>
<p id='n389' class='stm run hide_run'><a href='#n389'>389</a></p>
<p id='n390' class='stm run hide_run'><a href='#n390'>390</a></p>
<p id='n391' class='stm run hide_run'><a href='#n391'>391</a></p>
<p id='n392' class='stm run hide_run'><a href='#n392'>392</a></p>
<p id='n393' class='pln'><a href='#n393'>393</a></p>
<p id='n394' class='pln'><a href='#n394'>394</a></p>
<p id='n395' class='pln'><a href='#n395'>395</a></p>
<p id='n396' class='stm run hide_run'><a href='#n396'>396</a></p>
<p id='n397' class='pln'><a href='#n397'>397</a></p>
<p id='n398' class='pln'><a href='#n398'>398</a></p>
<p id='n399' class='pln'><a href='#n399'>399</a></p>
<p id='n400' class='pln'><a href='#n400'>400</a></p>
<p id='n401' class='pln'><a href='#n401'>401</a></p>
<p id='n402' class='pln'><a href='#n402'>402</a></p>
<p id='n403' class='stm run hide_run'><a href='#n403'>403</a></p>
<p id='n404' class='stm run hide_run'><a href='#n404'>404</a></p>
<p id='n405' class='pln'><a href='#n405'>405</a></p>
<p id='n406' class='stm run hide_run'><a href='#n406'>406</a></p>
<p id='n407' class='pln'><a href='#n407'>407</a></p>
<p id='n408' class='stm run hide_run'><a href='#n408'>408</a></p>
<p id='n409' class='pln'><a href='#n409'>409</a></p>
<p id='n410' class='pln'><a href='#n410'>410</a></p>
<p id='n411' class='pln'><a href='#n411'>411</a></p>
<p id='n412' class='pln'><a href='#n412'>412</a></p>
<p id='n413' class='pln'><a href='#n413'>413</a></p>
<p id='n414' class='pln'><a href='#n414'>414</a></p>
<p id='n415' class='stm run hide_run'><a href='#n415'>415</a></p>
<p id='n416' class='pln'><a href='#n416'>416</a></p>
<p id='n417' class='pln'><a href='#n417'>417</a></p>
<p id='n418' class='pln'><a href='#n418'>418</a></p>
<p id='n419' class='pln'><a href='#n419'>419</a></p>
<p id='n420' class='pln'><a href='#n420'>420</a></p>
<p id='n421' class='pln'><a href='#n421'>421</a></p>
<p id='n422' class='pln'><a href='#n422'>422</a></p>
<p id='n423' class='stm run hide_run'><a href='#n423'>423</a></p>
<p id='n424' class='stm run hide_run'><a href='#n424'>424</a></p>
<p id='n425' class='stm run hide_run'><a href='#n425'>425</a></p>
<p id='n426' class='stm run hide_run'><a href='#n426'>426</a></p>
<p id='n427' class='pln'><a href='#n427'>427</a></p>
<p id='n428' class='pln'><a href='#n428'>428</a></p>
<p id='n429' class='pln'><a href='#n429'>429</a></p>
<p id='n430' class='pln'><a href='#n430'>430</a></p>
<p id='n431' class='pln'><a href='#n431'>431</a></p>
<p id='n432' class='pln'><a href='#n432'>432</a></p>
<p id='n433' class='pln'><a href='#n433'>433</a></p>
<p id='n434' class='stm run hide_run'><a href='#n434'>434</a></p>
<p id='n435' class='stm run hide_run'><a href='#n435'>435</a></p>
<p id='n436' class='stm run hide_run'><a href='#n436'>436</a></p>
<p id='n437' class='pln'><a href='#n437'>437</a></p>
<p id='n438' class='stm run hide_run'><a href='#n438'>438</a></p>
<p id='n439' class='stm run hide_run'><a href='#n439'>439</a></p>
<p id='n440' class='stm run hide_run'><a href='#n440'>440</a></p>
<p id='n441' class='stm run hide_run'><a href='#n441'>441</a></p>
<p id='n442' class='stm run hide_run'><a href='#n442'>442</a></p>
<p id='n443' class='pln'><a href='#n443'>443</a></p>
<p id='n444' class='pln'><a href='#n444'>444</a></p>
<p id='n445' class='pln'><a href='#n445'>445</a></p>
<p id='n446' class='pln'><a href='#n446'>446</a></p>
<p id='n447' class='pln'><a href='#n447'>447</a></p>
<p id='n448' class='pln'><a href='#n448'>448</a></p>
<p id='n449' class='pln'><a href='#n449'>449</a></p>
<p id='n450' class='pln'><a href='#n450'>450</a></p>
<p id='n451' class='pln'><a href='#n451'>451</a></p>
<p id='n452' class='pln'><a href='#n452'>452</a></p>
<p id='n453' class='stm run hide_run'><a href='#n453'>453</a></p>
<p id='n454' class='pln'><a href='#n454'>454</a></p>
<p id='n455' class='pln'><a href='#n455'>455</a></p>
<p id='n456' class='pln'><a href='#n456'>456</a></p>
<p id='n457' class='pln'><a href='#n457'>457</a></p>
<p id='n458' class='stm run hide_run'><a href='#n458'>458</a></p>
<p id='n459' class='pln'><a href='#n459'>459</a></p>
<p id='n460' class='stm run hide_run'><a href='#n460'>460</a></p>
<p id='n461' class='pln'><a href='#n461'>461</a></p>
<p id='n462' class='pln'><a href='#n462'>462</a></p>
<p id='n463' class='pln'><a href='#n463'>463</a></p>
<p id='n464' class='pln'><a href='#n464'>464</a></p>
<p id='n465' class='stm run hide_run'><a href='#n465'>465</a></p>
<p id='n466' class='pln'><a href='#n466'>466</a></p>
<p id='n467' class='stm run hide_run'><a href='#n467'>467</a></p>
<p id='n468' class='pln'><a href='#n468'>468</a></p>
<p id='n469' class='pln'><a href='#n469'>469</a></p>
<p id='n470' class='stm run hide_run'><a href='#n470'>470</a></p>
<p id='n471' class='stm run hide_run'><a href='#n471'>471</a></p>
<p id='n472' class='pln'><a href='#n472'>472</a></p>
<p id='n473' class='pln'><a href='#n473'>473</a></p>
<p id='n474' class='pln'><a href='#n474'>474</a></p>
<p id='n475' class='pln'><a href='#n475'>475</a></p>
<p id='n476' class='pln'><a href='#n476'>476</a></p>
<p id='n477' class='pln'><a href='#n477'>477</a></p>
<p id='n478' class='pln'><a href='#n478'>478</a></p>
<p id='n479' class='pln'><a href='#n479'>479</a></p>
<p id='n480' class='pln'><a href='#n480'>480</a></p>
<p id='n481' class='stm run hide_run'><a href='#n481'>481</a></p>
<p id='n482' class='pln'><a href='#n482'>482</a></p>
<p id='n483' class='pln'><a href='#n483'>483</a></p>
<p id='n484' class='stm run hide_run'><a href='#n484'>484</a></p>
<p id='n485' class='pln'><a href='#n485'>485</a></p>
<p id='n486' class='pln'><a href='#n486'>486</a></p>
<p id='n487' class='pln'><a href='#n487'>487</a></p>
<p id='n488' class='stm run hide_run'><a href='#n488'>488</a></p>
<p id='n489' class='stm run hide_run'><a href='#n489'>489</a></p>
<p id='n490' class='pln'><a href='#n490'>490</a></p>
<p id='n491' class='stm run hide_run'><a href='#n491'>491</a></p>
<p id='n492' class='pln'><a href='#n492'>492</a></p>
<p id='n493' class='stm run hide_run'><a href='#n493'>493</a></p>
<p id='n494' class='stm run hide_run'><a href='#n494'>494</a></p>
<p id='n495' class='pln'><a href='#n495'>495</a></p>
<p id='n496' class='pln'><a href='#n496'>496</a></p>
<p id='n497' class='stm run hide_run'><a href='#n497'>497</a></p>
<p id='n498' class='pln'><a href='#n498'>498</a></p>
<p id='n499' class='pln'><a href='#n499'>499</a></p>
<p id='n500' class='pln'><a href='#n500'>500</a></p>
<p id='n501' class='pln'><a href='#n501'>501</a></p>
<p id='n502' class='pln'><a href='#n502'>502</a></p>
<p id='n503' class='pln'><a href='#n503'>503</a></p>
<p id='n504' class='pln'><a href='#n504'>504</a></p>
<p id='n505' class='stm run hide_run'><a href='#n505'>505</a></p>
<p id='n506' class='pln'><a href='#n506'>506</a></p>
<p id='n507' class='stm run hide_run'><a href='#n507'>507</a></p>
<p id='n508' class='stm run hide_run'><a href='#n508'>508</a></p>
<p id='n509' class='pln'><a href='#n509'>509</a></p>
<p id='n510' class='stm run hide_run'><a href='#n510'>510</a></p>
<p id='n511' class='pln'><a href='#n511'>511</a></p>
<p id='n512' class='pln'><a href='#n512'>512</a></p>
<p id='n513' class='pln'><a href='#n513'>513</a></p>
<p id='n514' class='pln'><a href='#n514'>514</a></p>
<p id='n515' class='pln'><a href='#n515'>515</a></p>
<p id='n516' class='pln'><a href='#n516'>516</a></p>
<p id='n517' class='pln'><a href='#n517'>517</a></p>
<p id='n518' class='pln'><a href='#n518'>518</a></p>
<p id='n519' class='pln'><a href='#n519'>519</a></p>
<p id='n520' class='pln'><a href='#n520'>520</a></p>
<p id='n521' class='pln'><a href='#n521'>521</a></p>
<p id='n522' class='pln'><a href='#n522'>522</a></p>
<p id='n523' class='pln'><a href='#n523'>523</a></p>
<p id='n524' class='pln'><a href='#n524'>524</a></p>
<p id='n525' class='pln'><a href='#n525'>525</a></p>
<p id='n526' class='pln'><a href='#n526'>526</a></p>
<p id='n527' class='pln'><a href='#n527'>527</a></p>
<p id='n528' class='pln'><a href='#n528'>528</a></p>
<p id='n529' class='pln'><a href='#n529'>529</a></p>
<p id='n530' class='pln'><a href='#n530'>530</a></p>
<p id='n531' class='pln'><a href='#n531'>531</a></p>
<p id='n532' class='pln'><a href='#n532'>532</a></p>
<p id='n533' class='pln'><a href='#n533'>533</a></p>
<p id='n534' class='pln'><a href='#n534'>534</a></p>
<p id='n535' class='pln'><a href='#n535'>535</a></p>
<p id='n536' class='pln'><a href='#n536'>536</a></p>
<p id='n537' class='pln'><a href='#n537'>537</a></p>
<p id='n538' class='pln'><a href='#n538'>538</a></p>
<p id='n539' class='pln'><a href='#n539'>539</a></p>
<p id='n540' class='pln'><a href='#n540'>540</a></p>
<p id='n541' class='pln'><a href='#n541'>541</a></p>
<p id='n542' class='pln'><a href='#n542'>542</a></p>
<p id='n543' class='pln'><a href='#n543'>543</a></p>
<p id='n544' class='pln'><a href='#n544'>544</a></p>
<p id='n545' class='pln'><a href='#n545'>545</a></p>
<p id='n546' class='pln'><a href='#n546'>546</a></p>
<p id='n547' class='pln'><a href='#n547'>547</a></p>
<p id='n548' class='pln'><a href='#n548'>548</a></p>
<p id='n549' class='pln'><a href='#n549'>549</a></p>
<p id='n550' class='pln'><a href='#n550'>550</a></p>
<p id='n551' class='pln'><a href='#n551'>551</a></p>
<p id='n552' class='pln'><a href='#n552'>552</a></p>
<p id='n553' class='pln'><a href='#n553'>553</a></p>
<p id='n554' class='pln'><a href='#n554'>554</a></p>
<p id='n555' class='pln'><a href='#n555'>555</a></p>
<p id='n556' class='pln'><a href='#n556'>556</a></p>
<p id='n557' class='pln'><a href='#n557'>557</a></p>
<p id='n558' class='pln'><a href='#n558'>558</a></p>
<p id='n559' class='pln'><a href='#n559'>559</a></p>
<p id='n560' class='pln'><a href='#n560'>560</a></p>
<p id='n561' class='pln'><a href='#n561'>561</a></p>
<p id='n562' class='pln'><a href='#n562'>562</a></p>
<p id='n563' class='stm run hide_run'><a href='#n563'>563</a></p>
<p id='n564' class='stm run hide_run'><a href='#n564'>564</a></p>
<p id='n565' class='pln'><a href='#n565'>565</a></p>
<p id='n566' class='pln'><a href='#n566'>566</a></p>
<p id='n567' class='pln'><a href='#n567'>567</a></p>
<p id='n568' class='pln'><a href='#n568'>568</a></p>
<p id='n569' class='pln'><a href='#n569'>569</a></p>
<p id='n570' class='pln'><a href='#n570'>570</a></p>
<p id='n571' class='pln'><a href='#n571'>571</a></p>
<p id='n572' class='pln'><a href='#n572'>572</a></p>
<p id='n573' class='pln'><a href='#n573'>573</a></p>
<p id='n574' class='pln'><a href='#n574'>574</a></p>
<p id='n575' class='pln'><a href='#n575'>575</a></p>
<p id='n576' class='pln'><a href='#n576'>576</a></p>
<p id='n577' class='pln'><a href='#n577'>577</a></p>
<p id='n578' class='pln'><a href='#n578'>578</a></p>
<p id='n579' class='stm run hide_run'><a href='#n579'>579</a></p>
<p id='n580' class='pln'><a href='#n580'>580</a></p>
                
            </td>
            <td class='text' valign='top'>
<p id='t1' class='stm run hide_run'><span class='key'>from</span> <span class='nam'>django</span><span class='op'>.</span><span class='nam'>contrib</span> <span class='key'>import</span> <span class='nam'>admin</span><span class='strut'>&nbsp;</span></p>
<p id='t2' class='stm run hide_run'><span class='key'>from</span> <span class='nam'>django</span><span class='op'>.</span><span class='nam'>forms</span> <span class='key'>import</span> <span class='nam'>CheckboxSelectMultiple</span><span class='op'>,</span> <span class='nam'>ModelForm</span><span class='strut'>&nbsp;</span></p>
<p id='t3' class='stm run hide_run'><span class='key'>from</span> <span class='nam'>django</span><span class='op'>.</span><span class='nam'>db</span> <span class='key'>import</span> <span class='nam'>models</span><span class='strut'>&nbsp;</span></p>
<p id='t4' class='stm run hide_run'><span class='key'>from</span> <span class='nam'>djock_app</span><span class='op'>.</span><span class='nam'>models</span> <span class='key'>import</span> <span class='nam'>LockUser</span><span class='op'>,</span> <span class='nam'>AccessTime</span><span class='op'>,</span> <span class='nam'>RFIDkeycard</span><span class='op'>,</span> <span class='nam'>Door</span><span class='strut'>&nbsp;</span></p>
<p id='t5' class='stm run hide_run'><span class='key'>from</span> <span class='nam'>termcolor</span> <span class='key'>import</span> <span class='nam'>colored</span><span class='strut'>&nbsp;</span></p>
<p id='t6' class='stm run hide_run'><span class='key'>from</span> <span class='nam'>django</span> <span class='key'>import</span> <span class='nam'>forms</span><span class='strut'>&nbsp;</span></p>
<p id='t7' class='stm run hide_run'><span class='key'>from</span> <span class='nam'>django</span><span class='op'>.</span><span class='nam'>contrib</span> <span class='key'>import</span> <span class='nam'>messages</span><span class='strut'>&nbsp;</span></p>
<p id='t8' class='pln'><span class='com'>#from chartit import DataPool, Chart</span><span class='strut'>&nbsp;</span></p>
<p id='t9' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t10' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t11' class='pln'><span class='com'>#########################&nbsp; TO DO ##########################################</span><span class='strut'>&nbsp;</span></p>
<p id='t12' class='pln'><span class='com'>#&nbsp; - Get rid of &quot;delete&quot; action for all except superuser, including not showing the button on change_list</span><span class='strut'>&nbsp;</span></p>
<p id='t13' class='pln'><span class='com'># - (maybe?): When a user is modified or added (in terms of being active at all or more/fewer doors access), e-mail all the staff. </span><span class='strut'>&nbsp;</span></p>
<p id='t14' class='pln'><span class='com'># - search bar for lockusers/accesstimes/doors change lists</span><span class='strut'>&nbsp;</span></p>
<p id='t15' class='pln'><span class='com'># -&nbsp; # the field labeled &quot;rfids&quot; should not be required.&nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t16' class='pln'><span class='com'>###########################################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t17' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t18' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t19' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t20' class='pln'><span class='str'>&quot;&quot;&quot; Staff user door management is not a current use case</span><span class='strut'>&nbsp;</span></p>
<p id='t21' class='pln'><span class='str'>class DoorAdmin(admin.ModelAdmin):</span><span class='strut'>&nbsp;</span></p>
<p id='t22' class='pln'><span class='str'>&nbsp; &nbsp; ###########################################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t23' class='pln'><span class='str'>&nbsp; &nbsp; # Page listing all Doors:</span><span class='strut'>&nbsp;</span></p>
<p id='t24' class='pln'><span class='str'>&nbsp; &nbsp; ###########################################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t25' class='pln'><span class='str'>&nbsp; &nbsp; # # field names to display, as columns</span><span class='strut'>&nbsp;</span></p>
<p id='t26' class='pln'><span class='str'>&nbsp; &nbsp; list_display = (&#39;name&#39;,&#39;id&#39;, &#39;description&#39;, &#39;get_allowed_lockusers_html_links&#39;,&#39;get_all_access_times&#39;,\</span><span class='strut'>&nbsp;</span></p>
<p id='t27' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; #&#39;prettify_get_allowed_rfids&#39; \</span><span class='strut'>&nbsp;</span></p>
<p id='t28' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; )</span><span class='strut'>&nbsp;</span></p>
<p id='t29' class='pln'><span class='str'>&nbsp; &nbsp; actions=None&nbsp; # don&#39;t provide the actions dropdown</span><span class='strut'>&nbsp;</span></p>
<p id='t30' class='pln'><span class='str'>&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t31' class='pln'><span class='str'>&nbsp; &nbsp; ###########################################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t32' class='pln'><span class='str'>&nbsp; &nbsp; # Individual Door page</span><span class='strut'>&nbsp;</span></p>
<p id='t33' class='pln'><span class='str'>&nbsp; &nbsp; ###########################################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t34' class='pln'><span class='str'>&nbsp; &nbsp; readonly_fields = (&#39;get_allowed_lockusers&#39;,&#39;get_all_access_times&#39;)&nbsp;&nbsp; # because obviously these shouldn&#39;t be editable.&nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t35' class='pln'><span class='str'>&nbsp; &nbsp; #(but commenting out if want to create some objects from admin vs shell just for fun)</span><span class='strut'>&nbsp;</span></p>
<p id='t36' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t37' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t38' class='pln'><span class='str'>&nbsp; &nbsp; # Staff users should only be able to manage doors that they have permissions for</span><span class='strut'>&nbsp;</span></p>
<p id='t39' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t40' class='pln'><span class='str'>&nbsp; &nbsp; # This works when the user is looking at the list of Doors (the change list page), </span><span class='strut'>&nbsp;</span></p>
<p id='t41' class='pln'><span class='str'>&nbsp; &nbsp; # but not when they&#39;re displayed on the lock user&#39;s change_form, and the user is </span><span class='strut'>&nbsp;</span></p>
<p id='t42' class='pln'><span class='str'>&nbsp; &nbsp; # able to add/remove any of those. I can restrict stuff template-level here,</span><span class='strut'>&nbsp;</span></p>
<p id='t43' class='pln'><span class='str'>&nbsp; &nbsp; # but that still seems wrong.... ???</span><span class='strut'>&nbsp;</span></p>
<p id='t44' class='pln'><span class='str'>&nbsp; &nbsp; def queryset(self, request):</span><span class='strut'>&nbsp;</span></p>
<p id='t45' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; if request.user.is_superuser:</span><span class='strut'>&nbsp;</span></p>
<p id='t46' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return Door.objects.all()</span><span class='strut'>&nbsp;</span></p>
<p id='t47' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; # but else if not superuser, is staff, is active: </span><span class='strut'>&nbsp;</span></p>
<p id='t48' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t49' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; doors_to_return = Door.objects.none()&nbsp; # creates an EmptyQuerySet</span><span class='strut'>&nbsp;</span></p>
<p id='t50' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; for door in Door.objects.all():</span><span class='strut'>&nbsp;</span></p>
<p id='t51' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; perm = &quot;djock_app.can_manage_door_%d&quot; % door.pk&nbsp;&nbsp; # put in proper format for has_perm</span><span class='strut'>&nbsp;</span></p>
<p id='t52' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if request.user.has_perm(perm):</span><span class='strut'>&nbsp;</span></p>
<p id='t53' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; doors_to_return = doors_to_return | Door.objects.filter(pk=door.pk)&nbsp; # concatenating QuerySets</span><span class='strut'>&nbsp;</span></p>
<p id='t54' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Doing door instead of the filter results in Error: &#39;Door&#39; object has no attribute &#39;_clone&#39;</span><span class='strut'>&nbsp;</span></p>
<p id='t55' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #doors_to_return = doors_to_return | door&nbsp;&nbsp; # concatenating QuerySets</span><span class='strut'>&nbsp;</span></p>
<p id='t56' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t57' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; return doors_to_return</span><span class='strut'>&nbsp;</span></p>
<p id='t58' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t59' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t60' class='pln'><span class='str'>&nbsp; &nbsp; def has_delete_permission(self, request, obj=None):</span><span class='strut'>&nbsp;</span></p>
<p id='t61' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; #Don&#39;t display &quot;delete&quot; button</span><span class='strut'>&nbsp;</span></p>
<p id='t62' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; return False</span><span class='strut'>&nbsp;</span></p>
<p id='t63' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t64' class='pln'><span class='str'>#&nbsp; &nbsp; def has_add_permission(self, request, obj=None):</span><span class='strut'>&nbsp;</span></p>
<p id='t65' class='pln'><span class='str'>#&nbsp; &nbsp; &nbsp; &nbsp; # Don&#39;t display Save And Add button</span><span class='strut'>&nbsp;</span></p>
<p id='t66' class='pln'><span class='str'>#&nbsp; &nbsp; &nbsp; &nbsp; return False</span><span class='strut'>&nbsp;</span></p>
<p id='t67' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t68' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t69' class='pln'><span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t70' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t71' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t72' class='pln'><span class='str'>&quot;&quot;&quot; has_perm(perm, obj=None) / has_perms(perm_list, obj=None)</span><span class='strut'>&nbsp;</span></p>
<p id='t73' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; Returns True if the user has the specified permission, where perm is in the format &quot;&lt;app label&gt;.&lt;permission codename&gt;&quot;. (see documentation on permissions). If the user is inactive, this method will always return False.</span><span class='strut'>&nbsp;</span></p>
<p id='t74' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t75' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; If obj is passed in, this method won&#39;t check for a permission for the model, but for this specific object.</span><span class='strut'>&nbsp;</span></p>
<p id='t76' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t77' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># permission codenames are named can_manage_door_x, where x is the pk num</span><span class='strut'>&nbsp;</span></p>
<p id='t78' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># else... return nothing and/or exception? </span><span class='strut'>&nbsp;</span></p>
<p id='t79' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t80' class='pln'><span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t81' class='pln'><span class='str'>class RFIDkeycardForm(ModelForm):</span><span class='strut'>&nbsp;</span></p>
<p id='t82' class='pln'><span class='str'>&nbsp; &nbsp; #the_rfid = IntegerField(help_text=&quot;help text&quot;)</span><span class='strut'>&nbsp;</span></p>
<p id='t83' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t84' class='pln'><span class='str'>&nbsp; &nbsp; # override __init__ to prepopulate the_rfid field with a random number, just to </span><span class='strut'>&nbsp;</span></p>
<p id='t85' class='pln'><span class='str'>&nbsp; &nbsp; #&nbsp;&nbsp; simulate assigning a new card</span><span class='strut'>&nbsp;</span></p>
<p id='t86' class='pln'><span class='str'>&nbsp; &nbsp; def __init__(self, *args, **kwargs):</span><span class='strut'>&nbsp;</span></p>
<p id='t87' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; super(RFIDkeycardForm, self).__init__(*args, **kwargs)</span><span class='strut'>&nbsp;</span></p>
<p id='t88' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; new_scan_queryset = NewKeycardScan.objects.all()</span><span class='strut'>&nbsp;</span></p>
<p id='t89' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; if new_scan_queryset: </span><span class='strut'>&nbsp;</span></p>
<p id='t90' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new_scan = new_scan_queryset.latest(&quot;time_initiated&quot;)&nbsp; # get the latest NewKeycardScan object, ordered by the field time_initiated (i.e. time the object was created) </span><span class='strut'>&nbsp;</span></p>
<p id='t91' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.fields[&#39;the_rfid&#39;] = IntegerField(help_text = &quot;(Not a random number -- from door/rfid check request)&quot;)</span><span class='strut'>&nbsp;</span></p>
<p id='t92' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.fields[&#39;the_rfid&#39;].initial = new_scan.rfid</span><span class='strut'>&nbsp;</span></p>
<p id='t93' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; else: </span><span class='strut'>&nbsp;</span></p>
<p id='t94' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.fields[&#39;the_rfid&#39;] = IntegerField(help_text = &quot;(This is a random number to simulate getting a new keycard number after it&#39;s scanned in.&lt;br&gt;Only superuser can actually see the number.)&quot;)</span><span class='strut'>&nbsp;</span></p>
<p id='t95' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.fields[&#39;the_rfid&#39;].initial = str(random.randint(0000000000,9999999999)) # rfid&#39;s should be 10 char long... just str&#39;ing ints, because I don&#39;t want to mess with random crap anymore.</span><span class='strut'>&nbsp;</span></p>
<p id='t96' class='pln'><span class='str'>&nbsp; &nbsp; class Meta:</span><span class='strut'>&nbsp;</span></p>
<p id='t97' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; model = RFIDkeycard</span><span class='strut'>&nbsp;</span></p>
<p id='t98' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t99' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t100' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t101' class='pln'><span class='str'>&nbsp; &nbsp; def save(self,*args,**kwargs):</span><span class='strut'>&nbsp;</span></p>
<p id='t102' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; try:</span><span class='strut'>&nbsp;</span></p>
<p id='t103' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; super(RFIDkeycardForm,self).save(*args,**kwargs)</span><span class='strut'>&nbsp;</span></p>
<p id='t104' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; except IntegrityError:</span><span class='strut'>&nbsp;</span></p>
<p id='t105' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # form passed validation, so didn&#39;t error there </span><span class='strut'>&nbsp;</span></p>
<p id='t106' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; errors = forms.util.ErrorList()</span><span class='strut'>&nbsp;</span></p>
<p id='t107' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; errors = forms._errors.setdefault(django.forms.forms.NON_FIELD_ERRORS, errors)</span><span class='strut'>&nbsp;</span></p>
<p id='t108' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; errors.append(&#39;Sorry, this RFID already exists.&#39;)</span><span class='strut'>&nbsp;</span></p>
<p id='t109' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t110' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t111' class='pln'><span class='str'>&nbsp; &nbsp; # playing with# trying to override save</span><span class='strut'>&nbsp;</span></p>
<p id='t112' class='pln'><span class='str'>#&nbsp; &nbsp; def save(self, commit=True, force_insert=False, force_update=False, *args, **kwargs):</span><span class='strut'>&nbsp;</span></p>
<p id='t113' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; # If anything overrides your form, or wants to modify what it&#39;s saving,</span><span class='strut'>&nbsp;</span></p>
<p id='t114' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; # it will do save(commit=False), modify the output, and then save it itself.</span><span class='strut'>&nbsp;</span></p>
<p id='t115' class='pln'><span class='str'>#&nbsp; &nbsp; &nbsp; &nbsp; rfcard = super(RFIDkeycardForm, self).save(commit=False, *args, **kwargs)</span><span class='strut'>&nbsp;</span></p>
<p id='t116' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; #################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t117' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; # do my custom stuff - </span><span class='strut'>&nbsp;</span></p>
<p id='t118' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; # (rfidkeycard actually will be saved same as always.&nbsp; But before it does so, I want to actually change the associated lockuser -- just to</span><span class='strut'>&nbsp;</span></p>
<p id='t119' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; # associate it with this keycard, so that after a page refresh of the original change_form, we</span><span class='strut'>&nbsp;</span></p>
<p id='t120' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; # should be able to see this change. /save</span><span class='strut'>&nbsp;</span></p>
<p id='t121' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t122' class='pln'><span class='str'>#&nbsp; &nbsp; &nbsp; &nbsp; if commit: </span><span class='strut'>&nbsp;</span></p>
<p id='t123' class='pln'><span class='str'>#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rfcard.save()</span><span class='strut'>&nbsp;</span></p>
<p id='t124' class='pln'><span class='str'>#&nbsp; &nbsp; &nbsp; &nbsp; return rfcard</span><span class='strut'>&nbsp;</span></p>
<p id='t125' class='pln'><span class='str'>#</span><span class='strut'>&nbsp;</span></p>
<p id='t126' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t127' class='pln'><span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t128' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t129' class='pln'><span class='com'># Only superuser/developers can access RFIDkeycard objects from outside LockUser</span><span class='strut'>&nbsp;</span></p>
<p id='t130' class='pln'><span class='str'>&quot;&quot;&quot; Staff user door management is not a current use case</span><span class='strut'>&nbsp;</span></p>
<p id='t131' class='pln'><span class='str'>class RFIDkeycardAdmin(admin.ModelAdmin):</span><span class='strut'>&nbsp;</span></p>
<p id='t132' class='pln'><span class='str'>&nbsp; &nbsp; #form = RFIDkeycardForm # prepopulating with random num</span><span class='strut'>&nbsp;</span></p>
<p id='t133' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t134' class='pln'><span class='str'>&nbsp; &nbsp; list_display = [&quot;the_rfid&quot;,&quot;id&quot;, &quot;date_created&quot;,&quot;date_revoked&quot;,&quot;is_active&quot;, &quot;lockuser&quot;,</span><span class='strut'>&nbsp;</span></p>
<p id='t135' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;get_allowed_doors_html_links&quot;]</span><span class='strut'>&nbsp;</span></p>
<p id='t136' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t137' class='pln'><span class='str'>&nbsp; &nbsp; ####################################################################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t138' class='pln'><span class='str'>&nbsp; &nbsp; # Individual page (change form)</span><span class='strut'>&nbsp;</span></p>
<p id='t139' class='pln'><span class='str'>&nbsp; &nbsp; ####################################################################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t140' class='pln'><span class='str'>&nbsp; &nbsp; #prepopulated_fields = { &#39;the_rfid&#39;: (&#39;id&#39;,)} </span><span class='strut'>&nbsp;</span></p>
<p id='t141' class='pln'><span class='str'>&nbsp; &nbsp; #fields = (&quot;the_rfid&quot;,&quot;date_revoked&quot;,&quot;date_created&quot;,&quot;id&quot;)</span><span class='strut'>&nbsp;</span></p>
<p id='t142' class='pln'><span class='str'>&nbsp; &nbsp; fields = (&quot;the_rfid&quot;,&quot;lockuser&quot;,&quot;date_created&quot;,&quot;date_revoked&quot;,&quot;get_allowed_doors&quot;,&quot;is_active&quot;)&nbsp; # here showing fields wouldn&#39;t show to a staff user, since the real (not inline) RFIDkeycard change_form would only be visible to superuser.</span><span class='strut'>&nbsp;</span></p>
<p id='t143' class='pln'><span class='str'>&nbsp; &nbsp; readonly_fields = (&quot;the_rfid&quot;,&quot;deactivate&quot;,&quot;lockuser&quot;,&quot;date_created&quot;,&quot;date_revoked&quot;,&quot;is_active&quot;,&quot;get_allowed_doors&quot;)</span><span class='strut'>&nbsp;</span></p>
<p id='t144' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t145' class='pln'><span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t146' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t147' class='stm run hide_run'><span class='key'>class</span> <span class='nam'>LockUserForm</span><span class='op'>(</span><span class='nam'>ModelForm</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t148' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>class</span> <span class='nam'>Meta</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t149' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>model</span> <span class='op'>=</span> <span class='nam'>LockUser</span><span class='strut'>&nbsp;</span></p>
<p id='t150' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t151' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='op'>*</span><span class='nam'>args</span><span class='op'>,</span> <span class='op'>**</span><span class='nam'>kwargs</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t152' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>request</span> <span class='op'>=</span> <span class='nam'>kwargs</span><span class='op'>.</span><span class='nam'>pop</span><span class='op'>(</span><span class='str'>&#39;request&#39;</span><span class='op'>,</span><span class='nam'>None</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t153' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>obj</span> <span class='op'>=</span> <span class='nam'>kwargs</span><span class='op'>.</span><span class='nam'>pop</span><span class='op'>(</span><span class='str'>&#39;obj&#39;</span><span class='op'>,</span><span class='nam'>None</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t154' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>doors_not_permitted_to_this_staff_user_but_for_lockuser</span> <span class='op'>=</span> <span class='nam'>kwargs</span><span class='op'>.</span><span class='nam'>pop</span><span class='op'>(</span><span class='str'>&#39;doors_not_permitted_to_this_staff_user_but_for_lockuser&#39;</span><span class='op'>,</span><span class='nam'>None</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t155' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t156' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>super</span><span class='op'>(</span><span class='nam'>LockUserForm</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>__init__</span><span class='op'>(</span><span class='op'>*</span><span class='nam'>args</span><span class='op'>,</span> <span class='op'>**</span><span class='nam'>kwargs</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t157' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t158' class='pln'>&nbsp; &nbsp; <span class='com'># todo:&nbsp; clean_fieldname? (https://docs.djangoproject.com/en/1.1/ref/forms/validation/#ref-forms-validation)</span><span class='strut'>&nbsp;</span></p>
<p id='t159' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>clean</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t160' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; If no Door were selected -- if user is not permitted to access any door </span><span class='strut'>&nbsp;</span></p>
<p id='t161' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -- deactivate associated keycard. </span><span class='strut'>&nbsp;</span></p>
<p id='t162' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; If the user is permitted access to doors that the staff user is not permitted access, make sure lockuser still has access to door staff user is not permitted to manage, since those wouldn&#39;t be on the form. Also, if &#39;deactivate current keycard&#39; was checked in this situation, the keycard should NOT actually be revoked, because of those other doors. </span><span class='strut'>&nbsp;</span></p>
<p id='t163' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (todo)</span><span class='strut'>&nbsp;</span></p>
<p id='t164' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t165' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>super</span><span class='op'>(</span><span class='nam'>forms</span><span class='op'>.</span><span class='nam'>ModelForm</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>clean</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t166' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># grab the cleaned fields we need</span><span class='strut'>&nbsp;</span></p>
<p id='t167' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>cleaned_doors</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>cleaned_data</span><span class='op'>.</span><span class='nam'>get</span><span class='op'>(</span><span class='str'>&quot;doors&quot;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t168' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># .get():&nbsp; if data not there, returns nothing - vs exception for [] </span><span class='strut'>&nbsp;</span></p>
<p id='t169' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>cleaned_deactivate_current_keycard</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>cleaned_data</span><span class='op'>.</span><span class='nam'>get</span><span class='op'>(</span><span class='str'>&quot;deactivate_current_keycard&quot;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t170' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t171' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># If the user is not permitted to access any door, set deactivate_current_keycard to True. Note that</span><span class='strut'>&nbsp;</span></p>
<p id='t172' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># we&#39;re changing cleaned_data here, not calling deactivate() on the associated RFIDkeycard.</span><span class='strut'>&nbsp;</span></p>
<p id='t173' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#if not cleaned_doors and not cleaned_deactivate_current_keycard:</span><span class='strut'>&nbsp;</span></p>
<p id='t174' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>cleaned_doors</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t175' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t176' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; self.cleaned_data[&#39;deactivate_current_keycard&#39;] = True</span><span class='strut'>&nbsp;</span></p>
<p id='t177' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t178' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>doors_not_permitted_to_this_staff_user_but_for_lockuser</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t179' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>cleaned_data</span><span class='op'>[</span><span class='str'>&#39;deactivate_current_keycard&#39;</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>True</span><span class='strut'>&nbsp;</span></p>
<p id='t180' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span>&nbsp; <span class='com'># don&#39;t deactivate keycard if no doors checked, because there are still doors lock user can access</span><span class='strut'>&nbsp;</span></p>
<p id='t181' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>cleaned_data</span><span class='op'>[</span><span class='str'>&#39;deactivate_current_keycard&#39;</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>False</span><span class='strut'>&nbsp;</span></p>
<p id='t182' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t183' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># todo:&nbsp; eek!&nbsp; just adding to cleaned_data!</span><span class='strut'>&nbsp;</span></p>
<p id='t184' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#msg = &quot;%s&#39;s keycard was not deactivated because you do not have permission to manage %s.&quot; % (self.obj, self.doors_not_permitted_to_this_staff_user_but_for_lockuser)</span><span class='strut'>&nbsp;</span></p>
<p id='t185' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>msg</span> <span class='op'>=</span> <span class='str'>&#39;will not deactivate&#39;</span><span class='strut'>&nbsp;</span></p>
<p id='t186' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#messages.add_message(self.request, messages.INFO, msg)</span><span class='strut'>&nbsp;</span></p>
<p id='t187' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>cleaned_data</span><span class='op'>[</span><span class='str'>&#39;special_message&#39;</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>msg</span><span class='strut'>&nbsp;</span></p>
<p id='t188' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t189' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>doors_not_permitted_to_this_staff_user_but_for_lockuser</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t190' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>item</span> <span class='key'>in</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>doors_not_permitted_to_this_staff_user_but_for_lockuser</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t191' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>cleaned_data</span><span class='op'>[</span><span class='str'>&#39;doors&#39;</span><span class='op'>]</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t192' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>cleaned_data</span><span class='op'>[</span><span class='str'>&#39;doors&#39;</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>cleaned_data</span><span class='op'>[</span><span class='str'>&#39;doors&#39;</span><span class='op'>]</span> <span class='op'>|</span> <span class='nam'>Door</span><span class='op'>.</span><span class='nam'>objects</span><span class='op'>.</span><span class='nam'>filter</span><span class='op'>(</span><span class='nam'>pk</span><span class='op'>=</span><span class='nam'>item</span><span class='op'>.</span><span class='nam'>pk</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t193' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t194' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>cleaned_data</span><span class='op'>[</span><span class='str'>&#39;doors&#39;</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>Door</span><span class='op'>.</span><span class='nam'>objects</span><span class='op'>.</span><span class='nam'>filter</span><span class='op'>(</span><span class='nam'>pk</span><span class='op'>=</span><span class='nam'>item</span><span class='op'>.</span><span class='nam'>pk</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t195' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t196' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># get the id of this door; add to QS</span><span class='strut'>&nbsp;</span></p>
<p id='t197' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>cleaned_data</span><span class='strut'>&nbsp;</span></p>
<p id='t198' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># temp/todo: </span><span class='strut'>&nbsp;</span></p>
<p id='t199' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># testing faking it: </span><span class='strut'>&nbsp;</span></p>
<p id='t200' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#form = form + &#39;&lt;li&gt;&lt;label for=&quot;id_doors_2&quot;&gt;&lt;input checked=&quot;checked&quot; type=&quot;checkbox&quot; name=&quot;doors&quot; value=&quot;2&quot; id=&quot;id_doors_2&quot; /&gt; Space 1&lt;/label&gt;&lt;/li&gt;&#39;</span><span class='strut'>&nbsp;</span></p>
<p id='t201' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t202' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t203' class='stm run hide_run'><span class='key'>class</span> <span class='nam'>LockUserAdmin</span><span class='op'>(</span><span class='nam'>admin</span><span class='op'>.</span><span class='nam'>ModelAdmin</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t204' class='pln'>&nbsp; &nbsp; <span class='com'>#inlines = [RFIDkeycardInline]</span><span class='strut'>&nbsp;</span></p>
<p id='t205' class='pln'>&nbsp; &nbsp; <span class='com'>#form = LockUserForm(request.POST, request=request)</span><span class='strut'>&nbsp;</span></p>
<p id='t206' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>form</span> <span class='op'>=</span> <span class='nam'>LockUserForm</span><span class='strut'>&nbsp;</span></p>
<p id='t207' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>get_form</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>request</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>,</span> <span class='op'>**</span><span class='nam'>kwargs</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t208' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>ModelForm</span> <span class='op'>=</span> <span class='nam'>super</span><span class='op'>(</span><span class='nam'>LockUserAdmin</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>get_form</span><span class='op'>(</span><span class='nam'>request</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>,</span> <span class='op'>**</span><span class='nam'>kwargs</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t209' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>class</span> <span class='nam'>ModelFormMetaClass</span><span class='op'>(</span><span class='nam'>ModelForm</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t210' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__new__</span><span class='op'>(</span><span class='nam'>cls</span><span class='op'>,</span> <span class='op'>*</span><span class='nam'>args</span><span class='op'>,</span> <span class='op'>**</span><span class='nam'>kwargs</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t211' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#kwargs[&#39;request&#39;] = request</span><span class='strut'>&nbsp;</span></p>
<p id='t212' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># get doors this lockuser can access but staff user cannot, unless creating a new user</span><span class='strut'>&nbsp;</span></p>
<p id='t213' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>obj</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t214' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>kwargs</span><span class='op'>[</span><span class='str'>&#39;doors_not_permitted_to_this_staff_user_but_for_lockuser&#39;</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>get_other_doors</span><span class='op'>(</span><span class='nam'>request</span><span class='op'>,</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>id</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t215' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>ModelForm</span><span class='op'>(</span><span class='op'>*</span><span class='nam'>args</span><span class='op'>,</span> <span class='op'>**</span><span class='nam'>kwargs</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t216' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>ModelFormMetaClass</span><span class='strut'>&nbsp;</span></p>
<p id='t217' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t218' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t219' class='pln'>&nbsp; &nbsp; <span class='com'>#def save_form(self,request,form,change):</span><span class='strut'>&nbsp;</span></p>
<p id='t220' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#super(LockUserAdmin, self).save_form(request, form, change)</span><span class='strut'>&nbsp;</span></p>
<p id='t221' class='pln'>&nbsp; &nbsp; <span class='com'>####################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t222' class='pln'>&nbsp; &nbsp; <span class='com'># Page listing all LockUsers (&quot;change list&quot; page):</span><span class='strut'>&nbsp;</span></p>
<p id='t223' class='pln'>&nbsp; &nbsp; <span class='com'>####################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t224' class='pln'>&nbsp; &nbsp; <span class='com'>#-------------------</span><span class='strut'>&nbsp;</span></p>
<p id='t225' class='pln'>&nbsp; &nbsp; <span class='com'># Actions dropdown</span><span class='strut'>&nbsp;</span></p>
<p id='t226' class='pln'>&nbsp; &nbsp; <span class='com'>#------------------</span><span class='strut'>&nbsp;</span></p>
<p id='t227' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>deactivate</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>request</span><span class='op'>,</span> <span class='nam'>queryset</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t228' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Staff should not have the ability to delete LockUsers, only to DEACTIVATE them. &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t229' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>obj</span> <span class='key'>in</span> <span class='nam'>queryset</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t230' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>doors_not_permitted_to_this_staff_user_but_for_lockuser</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>get_other_doors</span><span class='op'>(</span><span class='nam'>request</span><span class='op'>,</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>id</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t231' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>doors_not_permitted_to_this_staff_user_but_for_lockuser</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t232' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>deactivate_current_keycard</span> <span class='op'>=</span> <span class='nam'>True</span><span class='strut'>&nbsp;</span></p>
<p id='t233' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>current_keycard_revoker</span> <span class='op'>=</span> <span class='nam'>request</span><span class='op'>.</span><span class='nam'>user</span><span class='strut'>&nbsp;</span></p>
<p id='t234' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>save</span><span class='op'>(</span><span class='op'>)</span>&nbsp; &nbsp; <span class='com'>#otherwise associated keycard won&#39;t become deactivated</span><span class='strut'>&nbsp;</span></p>
<p id='t235' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>deactivate</span><span class='op'>.</span><span class='nam'>short_description</span> <span class='op'>=</span> <span class='str'>&quot;Deactivate selected lock users/keycards&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t236' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t237' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t238' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t239' class='pln'>&nbsp; &nbsp; <span class='com'>########&nbsp; todo:&nbsp; before doing the pragma thing actually, see :&nbsp; can i just leave off the &#39;pass&#39;.... ########&nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t240' class='pln'>&nbsp; &nbsp; <span class='com'># so later insert after the def, if have to: </span><span class='strut'>&nbsp;</span></p>
<p id='t241' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t242' class='pln'>&nbsp; &nbsp; <span class='com'># currently disabled -- not until production</span><span class='strut'>&nbsp;</span></p>
<p id='t243' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>email_selected</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>request</span><span class='op'>,</span> <span class='nam'>queryset</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t244' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Upon choosing this action, get new screen with field for entering body of email, etc. &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t245' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#pass</span><span class='strut'>&nbsp;</span></p>
<p id='t246' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>email_selected</span><span class='op'>.</span><span class='nam'>short_description</span> <span class='op'>=</span>&nbsp; <span class='str'>&quot;Email selected lock users (not implemented until production)&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t247' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t248' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t249' class='pln'>&nbsp; &nbsp; <span class='com'># Only the following actions will be shown in the dropdown</span><span class='strut'>&nbsp;</span></p>
<p id='t250' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>actions</span> <span class='op'>=</span> <span class='op'>(</span><span class='nam'>deactivate</span><span class='op'>,</span> <span class='nam'>email_selected</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t251' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t252' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t253' class='pln'>&nbsp; &nbsp; <span class='com'>#-------------------------</span><span class='strut'>&nbsp;</span></p>
<p id='t254' class='pln'>&nbsp; &nbsp; <span class='com'># Which fields to display</span><span class='strut'>&nbsp;</span></p>
<p id='t255' class='pln'>&nbsp; &nbsp; <span class='com'>#-------------------------</span><span class='strut'>&nbsp;</span></p>
<p id='t256' class='pln'>&nbsp; &nbsp; <span class='com'># fields (i.e. column headings)</span><span class='strut'>&nbsp;</span></p>
<p id='t257' class='pln'>&nbsp; &nbsp; <span class='com'># to do:&nbsp; show deactivated (i.e. no current keycard) in gray, or de-emphasize another way</span><span class='strut'>&nbsp;</span></p>
<p id='t258' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>list_display</span> <span class='op'>=</span> <span class='op'>(</span><span class='str'>&#39;first_name&#39;</span><span class='op'>,</span><span class='str'>&#39;last_name&#39;</span><span class='op'>,</span><span class='str'>&#39;email&#39;</span><span class='op'>,</span><span class='xx'>\</span><span class='strut'>&nbsp;</span></p>
<p id='t259' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;is_active&#39;</span><span class='op'>,</span><span class='xx'>\</span><span class='strut'>&nbsp;</span></p>
<p id='t260' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#&#39;prettify_get_current_rfid&#39;,\</span><span class='strut'>&nbsp;</span></p>
<p id='t261' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;_current_rfid_heading&#39;</span><span class='op'>,</span><span class='xx'>\</span><span class='strut'>&nbsp;</span></p>
<p id='t262' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#&#39;prettify_get_allowed_doors&#39;,\</span><span class='strut'>&nbsp;</span></p>
<p id='t263' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;_doors_heading&#39;</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p id='t264' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#&#39;prettify_get_last_access_time&#39;,</span><span class='strut'>&nbsp;</span></p>
<p id='t265' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;_last_access_heading&#39;</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p id='t266' class='pln'>&nbsp; &nbsp; <span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t267' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>readonly_fields</span> <span class='op'>=</span> <span class='op'>(</span><span class='str'>&quot;prettify_get_current_rfid&quot;</span><span class='op'>,</span> <span class='str'>&quot;get_all_rfids_html&quot;</span><span class='op'>,</span><span class='str'>&quot;last_access_time_and_link_to_more&quot;</span><span class='op'>,</span><span class='str'>&quot;prettify_get_last_access_time&quot;</span><span class='op'>,</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t268' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t269' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>list_filter</span> <span class='op'>=</span> <span class='op'>(</span><span class='str'>&#39;doors&#39;</span><span class='op'>,</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t270' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t271' class='pln'>&nbsp;&nbsp; <span class='com'>#list_display = (&#39;_my_field&#39;,)</span><span class='strut'>&nbsp;</span></p>
<p id='t272' class='pln'>&nbsp;&nbsp; <span class='com'>#readonly_fields = (&#39;_my_field&#39;, )&nbsp; &nbsp;&nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t273' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t274' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t275' class='pln'>&nbsp; &nbsp; <span class='com'>#-------------------------</span><span class='strut'>&nbsp;</span></p>
<p id='t276' class='pln'>&nbsp; &nbsp; <span class='com'># nicer column labels</span><span class='strut'>&nbsp;</span></p>
<p id='t277' class='pln'>&nbsp; &nbsp; <span class='com'>#------------------------</span><span class='strut'>&nbsp;</span></p>
<p id='t278' class='pln'>&nbsp; &nbsp; <span class='com'># todo: DRYer? (all of these)</span><span class='strut'>&nbsp;</span></p>
<p id='t279' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t280' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>_doors_heading</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t281' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>prettify_get_allowed_doors</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t282' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>_doors_heading</span><span class='op'>.</span><span class='nam'>short_description</span> <span class='op'>=</span> <span class='str'>&#39;Allowed doors&#39;</span><span class='strut'>&nbsp;</span></p>
<p id='t283' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t284' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>_last_access_heading</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t285' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>prettify_get_last_access_time</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t286' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># todo!!!!! need the last accessed door as well. So.........&nbsp; do that in models, actually .&nbsp; Some kind of prettify_get_last_access_time_plus_door</span><span class='strut'>&nbsp;</span></p>
<p id='t287' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>_last_access_heading</span><span class='op'>.</span><span class='nam'>short_description</span> <span class='op'>=</span> <span class='str'>&#39;Last access&#39;</span><span class='strut'>&nbsp;</span></p>
<p id='t288' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t289' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>_current_rfid_heading</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t290' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>prettify_get_current_rfid</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t291' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>_current_rfid_heading</span><span class='op'>.</span><span class='nam'>short_description</span> <span class='op'>=</span> <span class='str'>&#39;Current RFID&#39;</span><span class='strut'>&nbsp;</span></p>
<p id='t292' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t293' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t294' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t295' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t296' class='pln'>&nbsp; &nbsp; <span class='com'># Only the first and last names&nbsp; will appear as link to the individual LockUser page</span><span class='strut'>&nbsp;</span></p>
<p id='t297' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>list_display_links</span> <span class='op'>=</span> <span class='op'>[</span><span class='str'>&#39;first_name&#39;</span><span class='op'>,</span><span class='str'>&#39;last_name&#39;</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p id='t298' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t299' class='pln'>&nbsp; &nbsp; <span class='com'>####################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t300' class='pln'>&nbsp; &nbsp; <span class='com'># Individual LockUser page&nbsp; (change form)</span><span class='strut'>&nbsp;</span></p>
<p id='t301' class='pln'>&nbsp; &nbsp; <span class='com'>####################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t302' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t303' class='pln'>&nbsp; &nbsp; <span class='com'># Which fields to show, and in what order</span><span class='strut'>&nbsp;</span></p>
<p id='t304' class='pln'>&nbsp; &nbsp; <span class='com'># (parentheses group fields into a single line)</span><span class='strut'>&nbsp;</span></p>
<p id='t305' class='pln'>&nbsp; &nbsp; <span class='com'># to do:&nbsp; show deactivated (i.e. no current keycard) in gray, or de-emphasize another way</span><span class='strut'>&nbsp;</span></p>
<p id='t306' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>fieldsets</span> <span class='op'>=</span> <span class='op'>(</span><span class='strut'>&nbsp;</span></p>
<p id='t307' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>(</span><span class='nam'>None</span><span class='op'>,</span> <span class='op'>{</span><span class='strut'>&nbsp;</span></p>
<p id='t308' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;fields&#39;</span><span class='op'>:</span> <span class='op'>(</span> <span class='xx'>\</span><span class='strut'>&nbsp;</span></p>
<p id='t309' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>(</span><span class='str'>&#39;first_name&#39;</span><span class='op'>,</span> <span class='str'>&#39;last_name&#39;</span><span class='op'>)</span><span class='op'>,</span> <span class='xx'>\</span><span class='strut'>&nbsp;</span></p>
<p id='t310' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;email&#39;</span><span class='op'>,</span><span class='xx'>\</span><span class='strut'>&nbsp;</span></p>
<p id='t311' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;phone_number&#39;</span><span class='op'>,</span><span class='str'>&#39;address&#39;</span><span class='op'>,</span> <span class='xx'>\</span><span class='strut'>&nbsp;</span></p>
<p id='t312' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># will error if the below are not set as read_only...&nbsp; which makes sense; these are methods and</span><span class='strut'>&nbsp;</span></p>
<p id='t313' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># things I can&#39;t edit from the form.. </span><span class='strut'>&nbsp;</span></p>
<p id='t314' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;prettify_get_current_rfid&#39;</span><span class='op'>,</span><span class='xx'>\</span><span class='strut'>&nbsp;</span></p>
<p id='t315' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;last_access_time_and_link_to_more&#39;</span><span class='op'>,</span>&nbsp; <span class='xx'>\</span><span class='strut'>&nbsp;</span></p>
<p id='t316' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#&#39;is_active&#39;, \</span><span class='strut'>&nbsp;</span></p>
<p id='t317' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;doors&#39;</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p id='t318' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&#39;deactivate_current_keycard&#39;</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p id='t319' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#&nbsp; &#39;rfids&#39;,</span><span class='strut'>&nbsp;</span></p>
<p id='t320' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p id='t321' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t322' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class='com'># &#39;description&#39;: (&#39;description.....&nbsp; Create/modify new lock user and assign keycard&#39;)</span><span class='strut'>&nbsp;</span></p>
<p id='t323' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>}</span><span class='op'>)</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p id='t324' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t325' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t326' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t327' class='pln'>&nbsp; &nbsp; <span class='com'># display options as checkboxes, not default as selection list</span><span class='strut'>&nbsp;</span></p>
<p id='t328' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>formfield_overrides</span> <span class='op'>=</span> <span class='op'>{</span><span class='strut'>&nbsp;</span></p>
<p id='t329' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>models</span><span class='op'>.</span><span class='nam'>ManyToManyField</span><span class='op'>:</span> <span class='op'>{</span><span class='str'>&#39;widget&#39;</span><span class='op'>:</span> <span class='nam'>CheckboxSelectMultiple</span><span class='op'>}</span><span class='op'>,</span><span class='strut'>&nbsp;</span></p>
<p id='t330' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='op'>}</span><span class='strut'>&nbsp;</span></p>
<p id='t331' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t332' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t333' class='pln'>&nbsp; &nbsp; <span class='com'># TO DO: refactor these func....</span><span class='strut'>&nbsp;</span></p>
<p id='t334' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>get_doors_to_show</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span><span class='nam'>request</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t335' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#(todo/temp) object_id is currently only used for debugging</span><span class='strut'>&nbsp;</span></p>
<p id='t336' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># superuser will always see all doors (doors_to_show)</span><span class='strut'>&nbsp;</span></p>
<p id='t337' class='exc'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>request</span><span class='op'>.</span><span class='nam'>user</span><span class='op'>.</span><span class='nam'>is_superuser</span><span class='op'>:</span> <span class='com'># pragma: no cover (exclude from coverage report - superuser distinction is a development-only feature)</span><span class='strut'>&nbsp;</span></p>
<p id='t338' class='exc'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>Door</span><span class='op'>.</span><span class='nam'>objects</span><span class='op'>.</span><span class='nam'>all</span><span class='op'>(</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t339' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># otherwise filter on permissions</span><span class='strut'>&nbsp;</span></p>
<p id='t340' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>doors_to_show</span> <span class='op'>=</span> <span class='nam'>Door</span><span class='op'>.</span><span class='nam'>objects</span><span class='op'>.</span><span class='nam'>none</span><span class='op'>(</span><span class='op'>)</span>&nbsp; <span class='com'># creates an EmptyQuerySet</span><span class='strut'>&nbsp;</span></p>
<p id='t341' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>door</span> <span class='key'>in</span> <span class='nam'>Door</span><span class='op'>.</span><span class='nam'>objects</span><span class='op'>.</span><span class='nam'>all</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t342' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>perm</span> <span class='op'>=</span> <span class='str'>&quot;djock_app.can_manage_door_%d&quot;</span> <span class='op'>%</span> <span class='nam'>door</span><span class='op'>.</span><span class='nam'>pk</span>&nbsp;&nbsp; <span class='com'># put in proper format for has_perm</span><span class='strut'>&nbsp;</span></p>
<p id='t343' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>request</span><span class='op'>.</span><span class='nam'>user</span><span class='op'>.</span><span class='nam'>has_perm</span><span class='op'>(</span><span class='nam'>perm</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t344' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>doors_to_show</span> <span class='op'>=</span> <span class='nam'>doors_to_show</span> <span class='op'>|</span> <span class='nam'>Door</span><span class='op'>.</span><span class='nam'>objects</span><span class='op'>.</span><span class='nam'>filter</span><span class='op'>(</span><span class='nam'>pk</span><span class='op'>=</span><span class='nam'>door</span><span class='op'>.</span><span class='nam'>pk</span><span class='op'>)</span>&nbsp; <span class='com'># concatenating QuerySets</span><span class='strut'>&nbsp;</span></p>
<p id='t345' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>doors_to_show</span><span class='strut'>&nbsp;</span></p>
<p id='t346' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t347' class='pln'>&nbsp; &nbsp; <span class='com'># todo: refactor in terms of this template/admin divide? </span><span class='strut'>&nbsp;</span></p>
<p id='t348' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>get_other_doors</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>request</span><span class='op'>,</span><span class='nam'>object_id</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t349' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Doors that the staff User is not allowed to administer. In</span><span class='strut'>&nbsp;</span></p>
<p id='t350' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; change_form template, will get a set of these Door objects from context,</span><span class='strut'>&nbsp;</span></p>
<p id='t351' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; then check the lockuser_set of each to see if the current lockuser has</span><span class='strut'>&nbsp;</span></p>
<p id='t352' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; access to it.&nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t353' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t354' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; (todo/temp) object_id is currently only used for debugging</span><span class='strut'>&nbsp;</span></p>
<p id='t355' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t356' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; todo: do the check for whether lockuser actually has perms for the non-permitted door here</span><span class='strut'>&nbsp;</span></p>
<p id='t357' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t358' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>this_lu</span> <span class='op'>=</span> <span class='nam'>LockUser</span><span class='op'>.</span><span class='nam'>objects</span><span class='op'>.</span><span class='nam'>filter</span><span class='op'>(</span><span class='nam'>id</span><span class='op'>=</span><span class='nam'>object_id</span><span class='op'>)</span><span class='op'>[</span><span class='num'>0</span><span class='op'>]</span><span class='strut'>&nbsp;</span></p>
<p id='t359' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t360' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t361' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># superuser will always see all doors (doors_to_show)</span><span class='strut'>&nbsp;</span></p>
<p id='t362' class='exc'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>request</span><span class='op'>.</span><span class='nam'>user</span><span class='op'>.</span><span class='nam'>is_superuser</span><span class='op'>:</span> <span class='com'># pragma: no cover (exclude from coverage report - superuser distinction is a development-only feature)</span><span class='strut'>&nbsp;</span></p>
<p id='t363' class='exc'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>None</span><span class='strut'>&nbsp;</span></p>
<p id='t364' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># otherwise filter on permissions</span><span class='strut'>&nbsp;</span></p>
<p id='t365' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>doors_not_permitted_to_this_staff_user</span> <span class='op'>=</span> <span class='nam'>Door</span><span class='op'>.</span><span class='nam'>objects</span><span class='op'>.</span><span class='nam'>none</span><span class='op'>(</span><span class='op'>)</span>&nbsp; <span class='com'># creates an EmptyQuerySet</span><span class='strut'>&nbsp;</span></p>
<p id='t366' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>for</span> <span class='nam'>door</span> <span class='key'>in</span> <span class='nam'>Door</span><span class='op'>.</span><span class='nam'>objects</span><span class='op'>.</span><span class='nam'>all</span><span class='op'>(</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t367' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>perm</span> <span class='op'>=</span> <span class='str'>&quot;djock_app.can_manage_door_%d&quot;</span> <span class='op'>%</span> <span class='nam'>door</span><span class='op'>.</span><span class='nam'>pk</span>&nbsp;&nbsp; <span class='com'># put in proper format for has_perm</span><span class='strut'>&nbsp;</span></p>
<p id='t368' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t369' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='key'>not</span> <span class='nam'>request</span><span class='op'>.</span><span class='nam'>user</span><span class='op'>.</span><span class='nam'>has_perm</span><span class='op'>(</span><span class='nam'>perm</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t370' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>doors_not_permitted_to_this_staff_user</span> <span class='op'>=</span> <span class='nam'>doors_not_permitted_to_this_staff_user</span> <span class='op'>|</span> <span class='nam'>Door</span><span class='op'>.</span><span class='nam'>objects</span><span class='op'>.</span><span class='nam'>filter</span><span class='op'>(</span><span class='nam'>pk</span><span class='op'>=</span><span class='nam'>door</span><span class='op'>.</span><span class='nam'>pk</span><span class='op'>)</span>&nbsp; <span class='com'># concatenating QuerySets</span><span class='strut'>&nbsp;</span></p>
<p id='t371' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># todo:&nbsp; no sets please</span><span class='strut'>&nbsp;</span></p>
<p id='t372' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>doors_not_permitted_to_this_staff_user_but_for_lockuser</span> <span class='op'>=</span> <span class='nam'>set</span><span class='op'>(</span><span class='nam'>this_lu</span><span class='op'>.</span><span class='nam'>get_allowed_doors</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>intersection</span><span class='op'>(</span><span class='nam'>set</span><span class='op'>(</span><span class='nam'>doors_not_permitted_to_this_staff_user</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t373' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># all elem that are in this set but not the other. i.e. all doors </span><span class='strut'>&nbsp;</span></p>
<p id='t374' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#return doors_not_permitted_to_this_staff_user</span><span class='strut'>&nbsp;</span></p>
<p id='t375' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t376' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>doors_not_permitted_to_this_staff_user_but_for_lockuser</span><span class='strut'>&nbsp;</span></p>
<p id='t377' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># todo: umm... rename these...</span><span class='strut'>&nbsp;</span></p>
<p id='t378' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t379' class='pln'>&nbsp; &nbsp; <span class='com'># The queryset() method in DoorAdmin restricts a staff user&#39;s ability to </span><span class='strut'>&nbsp;</span></p>
<p id='t380' class='pln'>&nbsp; &nbsp; <span class='com'>#&nbsp;&nbsp; view/change Doors that they do not have permission for (individual objects and change list).</span><span class='strut'>&nbsp;</span></p>
<p id='t381' class='pln'>&nbsp; &nbsp; <span class='com'># But on the listdisplay and changeform for LockUsers, staff users can still see Doors </span><span class='strut'>&nbsp;</span></p>
<p id='t382' class='pln'>&nbsp; &nbsp; <span class='com'>#&nbsp;&nbsp; -- and assign them -- that they don&#39;t have permission for.&nbsp; So here, we need to limit the </span><span class='strut'>&nbsp;</span></p>
<p id='t383' class='pln'>&nbsp; &nbsp; <span class='com'>#&nbsp;&nbsp; ManyToMany Door field output for the LockUser.&nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t384' class='pln'>&nbsp; &nbsp; <span class='com'>#</span><span class='strut'>&nbsp;</span></p>
<p id='t385' class='pln'>&nbsp; &nbsp; <span class='com'># TO DO: maybe it makes more sense for non-permitted doors to be viewable </span><span class='strut'>&nbsp;</span></p>
<p id='t386' class='pln'>&nbsp; &nbsp; <span class='com'># (Door changelist, LockUser displaylist, LockUser changeform), but be grayed out/readonly</span><span class='strut'>&nbsp;</span></p>
<p id='t387' class='pln'>&nbsp; &nbsp; <span class='com'>#</span><span class='strut'>&nbsp;</span></p>
<p id='t388' class='pln'>&nbsp; &nbsp; <span class='com'># TO DO: refactor!</span><span class='strut'>&nbsp;</span></p>
<p id='t389' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>formfield_for_manytomany</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>db_field</span><span class='op'>,</span> <span class='nam'>request</span><span class='op'>,</span> <span class='op'>**</span><span class='nam'>kwargs</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t390' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>db_field</span><span class='op'>.</span><span class='nam'>name</span> <span class='op'>==</span> <span class='str'>&quot;doors&quot;</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t391' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>kwargs</span><span class='op'>[</span><span class='str'>&quot;queryset&quot;</span><span class='op'>]</span> <span class='op'>=</span> <span class='nam'>self</span><span class='op'>.</span><span class='nam'>get_doors_to_show</span><span class='op'>(</span><span class='nam'>request</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t392' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>super</span><span class='op'>(</span><span class='nam'>LockUserAdmin</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>formfield_for_manytomany</span><span class='op'>(</span><span class='nam'>db_field</span><span class='op'>,</span> <span class='nam'>request</span><span class='op'>,</span> <span class='op'>**</span><span class='nam'>kwargs</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t393' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t394' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t395' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t396' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>change_view</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>request</span><span class='op'>,</span> <span class='nam'>object_id</span><span class='op'>,</span> <span class='nam'>form_url</span><span class='op'>=</span><span class='str'>&#39;&#39;</span><span class='op'>,</span> <span class='nam'>extra_context</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t397' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;&nbsp; LockUser may have access to Doors that the staff user cannot admin;</span><span class='strut'>&nbsp;</span></p>
<p id='t398' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; this must be accounted for when determining (Javascript) whether to</span><span class='strut'>&nbsp;</span></p>
<p id='t399' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; disable &quot;Assign keycard&quot; button or select &quot;Deactivate keycard&quot; because</span><span class='strut'>&nbsp;</span></p>
<p id='t400' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; all Doors have been unchecked.&nbsp; In change_form template, will get a set</span><span class='strut'>&nbsp;</span></p>
<p id='t401' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; of these Door objects from context, then check the lockuser_set of each</span><span class='strut'>&nbsp;</span></p>
<p id='t402' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; to see if the current lockuser has access to it.&nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t403' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>extra_context</span><span class='op'>=</span><span class='op'>{</span><span class='str'>&quot;doors_not_permitted_to_this_staff_user&quot;</span><span class='op'>:</span><span class='nam'>self</span><span class='op'>.</span><span class='nam'>get_other_doors</span><span class='op'>(</span><span class='nam'>request</span><span class='op'>,</span> <span class='nam'>object_id</span><span class='op'>)</span><span class='op'>}</span>&nbsp;&nbsp; <span class='com'># todo:&nbsp; ugh rename var</span><span class='strut'>&nbsp;</span></p>
<p id='t404' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>super</span><span class='op'>(</span><span class='nam'>LockUserAdmin</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>change_view</span><span class='op'>(</span><span class='nam'>request</span><span class='op'>,</span> <span class='nam'>object_id</span><span class='op'>,</span> <span class='nam'>form_url</span><span class='op'>,</span> <span class='nam'>extra_context</span><span class='op'>=</span><span class='nam'>extra_context</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t405' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t406' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>has_delete_permission</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>request</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t407' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Don&#39;t display &quot;delete&quot; button &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t408' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>False</span><span class='strut'>&nbsp;</span></p>
<p id='t409' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#return True&nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t410' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># todo/temp commenting out </span><span class='strut'>&nbsp;</span></p>
<p id='t411' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># so back to False later</span><span class='strut'>&nbsp;</span></p>
<p id='t412' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t413' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t414' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t415' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>save_model</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span><span class='nam'>request</span><span class='op'>,</span><span class='nam'>obj</span><span class='op'>,</span><span class='nam'>form</span><span class='op'>,</span><span class='nam'>change</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t416' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># if deactivate current keycard was checked (which may have actually happened in clean, if&nbsp; no Doors were selected) </span><span class='strut'>&nbsp;</span></p>
<p id='t417' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># need to deactivate current keycard.&nbsp; Doing this</span><span class='strut'>&nbsp;</span></p>
<p id='t418' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># here rather than models.py because need to attach request.user to the RFIDkeycard object being</span><span class='strut'>&nbsp;</span></p>
<p id='t419' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># deactivated, to record revoker</span><span class='strut'>&nbsp;</span></p>
<p id='t420' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>## todo:&nbsp; a better way to do this?</span><span class='strut'>&nbsp;</span></p>
<p id='t421' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t422' class='pln'>&nbsp; &nbsp; &nbsp;&nbsp; <span class='com'># if obj.deactivate_current_keycard or not obj.doors.exists():&nbsp; # although deactivate_current_keycard should have been set to true in clean, if no doors</span><span class='strut'>&nbsp;</span></p>
<p id='t423' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>deactivate_current_keycard</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t424' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>current_keycard_revoker</span> <span class='op'>=</span> <span class='nam'>request</span><span class='op'>.</span><span class='nam'>user</span><span class='strut'>&nbsp;</span></p>
<p id='t425' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>msg</span> <span class='op'>=</span> <span class='str'>&quot;%s&#39;s keycard was deactivated successfully.&quot;</span> <span class='op'>%</span> <span class='nam'>obj</span><span class='strut'>&nbsp;</span></p>
<p id='t426' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>messages</span><span class='op'>.</span><span class='nam'>add_message</span><span class='op'>(</span><span class='nam'>request</span><span class='op'>,</span> <span class='nam'>messages</span><span class='op'>.</span><span class='nam'>INFO</span><span class='op'>,</span> <span class='nam'>msg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t427' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t428' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#current_keycard = obj.get_current_rfid() </span><span class='strut'>&nbsp;</span></p>
<p id='t429' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#if current_keycard:</span><span class='strut'>&nbsp;</span></p>
<p id='t430' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#&nbsp; &nbsp; current_keycard.deactivate(request.user)</span><span class='strut'>&nbsp;</span></p>
<p id='t431' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#&nbsp; &nbsp; current_keycard.save()</span><span class='strut'>&nbsp;</span></p>
<p id='t432' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># there may be no current keycard, so a new one should be prevented from being assigned</span><span class='strut'>&nbsp;</span></p>
<p id='t433' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>else</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t434' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>current_keycard_revoker</span> <span class='op'>=</span> <span class='nam'>None</span><span class='strut'>&nbsp;</span></p>
<p id='t435' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>try</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t436' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>if</span> <span class='nam'>form</span><span class='op'>.</span><span class='nam'>cleaned_data</span><span class='op'>[</span><span class='str'>&#39;special_message&#39;</span><span class='op'>]</span> <span class='op'>==</span> <span class='str'>&#39;will not deactivate&#39;</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t437' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># nicer way to print the doors, not &quot;set([&lt;Door: Space 1&gt;])&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t438' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>doors_not_permit</span> <span class='op'>=</span> <span class='str'>&quot;, &quot;</span><span class='op'>.</span><span class='nam'>join</span><span class='op'>(</span><span class='nam'>door</span><span class='op'>.</span><span class='nam'>name</span> <span class='key'>for</span> <span class='nam'>door</span> <span class='key'>in</span> <span class='nam'>list</span><span class='op'>(</span><span class='nam'>form</span><span class='op'>.</span><span class='nam'>doors_not_permitted_to_this_staff_user_but_for_lockuser</span><span class='op'>)</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t439' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>msg</span> <span class='op'>=</span> <span class='str'>&quot;%s&#39;s keycard was not deactivated because you do not have permission to manage %s.&quot;</span> <span class='op'>%</span> <span class='op'>(</span><span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>doors_not_permit</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t440' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>messages</span><span class='op'>.</span><span class='nam'>add_message</span><span class='op'>(</span><span class='nam'>request</span><span class='op'>,</span> <span class='nam'>messages</span><span class='op'>.</span><span class='nam'>INFO</span><span class='op'>,</span> <span class='nam'>msg</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t441' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>except</span> <span class='nam'>KeyError</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t442' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>pass</span><span class='strut'>&nbsp;</span></p>
<p id='t443' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t444' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#msg = form.cleaned_data[&quot;special_message&quot;]</span><span class='strut'>&nbsp;</span></p>
<p id='t445' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t446' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># todo --&nbsp; ugh this better not be totally before save. </span><span class='strut'>&nbsp;</span></p>
<p id='t447' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t448' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t449' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t450' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># temp/todo: </span><span class='strut'>&nbsp;</span></p>
<p id='t451' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># testing faking it: </span><span class='strut'>&nbsp;</span></p>
<p id='t452' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#form = form + &#39;&lt;li&gt;&lt;label for=&quot;id_doors_2&quot;&gt;&lt;input checked=&quot;checked&quot; type=&quot;checkbox&quot; name=&quot;doors&quot; value=&quot;2&quot; id=&quot;id_doors_2&quot; /&gt; Space 1&lt;/label&gt;&lt;/li&gt;&#39;</span><span class='strut'>&nbsp;</span></p>
<p id='t453' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>super</span><span class='op'>(</span><span class='nam'>LockUserAdmin</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>save_model</span><span class='op'>(</span><span class='nam'>request</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>,</span> <span class='nam'>form</span><span class='op'>,</span> <span class='nam'>change</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t454' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t455' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t456' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t457' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t458' class='stm run hide_run'><span class='key'>class</span> <span class='nam'>AccessTimeAdmin</span><span class='op'>(</span><span class='nam'>admin</span><span class='op'>.</span><span class='nam'>ModelAdmin</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t459' class='pln'>&nbsp; &nbsp; <span class='com'># todo: </span><span class='strut'>&nbsp;</span></p>
<p id='t460' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>__init__</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='op'>*</span><span class='nam'>args</span><span class='op'>,</span> <span class='op'>**</span><span class='nam'>kwargs</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t461' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Only defining here because simply including</span><span class='strut'>&nbsp;</span></p>
<p id='t462' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list_display_links = []</span><span class='strut'>&nbsp;</span></p>
<p id='t463' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; above does not work; it defaults to linking from items in AccessTime col</span><span class='strut'>&nbsp;</span></p>
<p id='t464' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t465' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>super</span><span class='op'>(</span><span class='nam'>AccessTimeAdmin</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>__init__</span><span class='op'>(</span><span class='op'>*</span><span class='nam'>args</span><span class='op'>,</span> <span class='op'>**</span><span class='nam'>kwargs</span><span class='op'>)</span> <span class='com'># todo: is this appropriate here? </span><span class='strut'>&nbsp;</span></p>
<p id='t466' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t467' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>changelist_view</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>request</span><span class='op'>,</span> <span class='nam'>extra_context</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t468' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Don&#39;t show links for any item&nbsp; &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t469' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># No need to show the link to&nbsp; page for an individual AccessTime, so no field should link to it.</span><span class='strut'>&nbsp;</span></p>
<p id='t470' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='nam'>self</span><span class='op'>.</span><span class='nam'>list_display_links</span> <span class='op'>=</span> <span class='op'>(</span><span class='nam'>None</span><span class='op'>,</span> <span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t471' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>super</span><span class='op'>(</span><span class='nam'>AccessTimeAdmin</span><span class='op'>,</span> <span class='nam'>self</span><span class='op'>)</span><span class='op'>.</span><span class='nam'>changelist_view</span><span class='op'>(</span><span class='nam'>request</span><span class='op'>,</span> <span class='nam'>extra_context</span><span class='op'>=</span><span class='nam'>extra_context</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t472' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t473' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t474' class='pln'>&nbsp; &nbsp; <span class='com'>#########################################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t475' class='pln'>&nbsp; &nbsp; <span class='com'># Page listing all AccessTimes (&quot;change list&quot; page):</span><span class='strut'>&nbsp;</span></p>
<p id='t476' class='pln'>&nbsp; &nbsp; <span class='com'>#########################################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t477' class='pln'>&nbsp; &nbsp; <span class='com'># max num of entries per page</span><span class='strut'>&nbsp;</span></p>
<p id='t478' class='pln'>&nbsp; &nbsp; <span class='com'>#list_per_page = 100</span><span class='strut'>&nbsp;</span></p>
<p id='t479' class='pln'>&nbsp; &nbsp; <span class='com'># # field names to display, as columns</span><span class='strut'>&nbsp;</span></p>
<p id='t480' class='pln'>&nbsp; &nbsp; <span class='com'>#list_display = (&#39;access_time&#39;,&#39;get_this_lockuser_html&#39;,&#39;get_this_door&#39;)</span><span class='strut'>&nbsp;</span></p>
<p id='t481' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>list_display</span> <span class='op'>=</span> <span class='op'>(</span><span class='str'>&#39;access_time&#39;</span><span class='op'>,</span><span class='str'>&#39;lockuser_html_heading&#39;</span><span class='op'>,</span><span class='str'>&#39;door&#39;</span><span class='op'>)</span>&nbsp;&nbsp; <span class='com'># if just &#39;lockuser&#39;, won&#39;t get html for link... todo: but I think there&#39;s an easier way to do this</span><span class='strut'>&nbsp;</span></p>
<p id='t482' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t483' class='pln'>&nbsp; &nbsp; <span class='com'># todo: method names </span><span class='strut'>&nbsp;</span></p>
<p id='t484' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>lockuser_html_heading</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t485' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Returns the HTML with link to lock user&#39;s change_form to display on</span><span class='strut'>&nbsp;</span></p>
<p id='t486' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the Access Times change list page &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t487' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'>#return obj.get_this_lockuser_html()</span><span class='strut'>&nbsp;</span></p>
<p id='t488' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='str'>&quot;&lt;a href=&#39;../lockuser/%d/&#39;&gt;%s&lt;/a&gt;&quot;</span> <span class='op'>%</span>&nbsp; <span class='op'>(</span><span class='nam'>obj</span><span class='op'>.</span><span class='nam'>lockuser</span><span class='op'>.</span><span class='nam'>id</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>.</span><span class='nam'>lockuser</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t489' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>lockuser_html_heading</span><span class='op'>.</span><span class='nam'>short_description</span> <span class='op'>=</span> <span class='str'>&#39;User&#39;</span><span class='strut'>&nbsp;</span></p>
<p id='t490' class='pln'>&nbsp; &nbsp; <span class='com'># Django will HTML-escape the output by default. If you&#39;d rather not escape the output of the method, give the method an allow_tags attribute whose value is True.</span><span class='strut'>&nbsp;</span></p>
<p id='t491' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>lockuser_html_heading</span><span class='op'>.</span><span class='nam'>allow_tags</span> <span class='op'>=</span> <span class='nam'>True</span><span class='strut'>&nbsp;</span></p>
<p id='t492' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t493' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>actions</span><span class='op'>=</span><span class='nam'>None</span>&nbsp; <span class='com'># don&#39;t provide the actions dropdown</span><span class='strut'>&nbsp;</span></p>
<p id='t494' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>date_hierarchy</span> <span class='op'>=</span> <span class='str'>&#39;access_time&#39;</span> <span class='com'># Set date_hierarchy to the name of a DateField or DateTimeField in model, and the</span><span class='strut'>&nbsp;</span></p>
<p id='t495' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># change list page will include a date-based drilldown navigation by that field. (i.e. shows months or days or</span><span class='strut'>&nbsp;</span></p>
<p id='t496' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='com'># years or whatever at the top)</span><span class='strut'>&nbsp;</span></p>
<p id='t497' class='stm run hide_run'>&nbsp; &nbsp; <span class='nam'>list_filter</span> <span class='op'>=</span> <span class='op'>(</span><span class='str'>&#39;lockuser&#39;</span><span class='op'>,</span><span class='str'>&#39;door&#39;</span><span class='op'>)</span>&nbsp; <span class='com'># show filters by RFID and active/inactive on the right</span><span class='strut'>&nbsp;</span></p>
<p id='t498' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t499' class='pln'>&nbsp; &nbsp; <span class='com'>#########################################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t500' class='pln'>&nbsp; &nbsp; <span class='com'># Individual TimeAccess page</span><span class='strut'>&nbsp;</span></p>
<p id='t501' class='pln'>&nbsp; &nbsp; <span class='com'># (Although there&#39;s no need link to an individual AccessTime object&#39;s page, it still exists.)</span><span class='strut'>&nbsp;</span></p>
<p id='t502' class='pln'>&nbsp; &nbsp; <span class='com'>#########################################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t503' class='pln'>&nbsp;&nbsp; <span class='com'># readonly_fields = (&#39;access_time&#39;,&#39;rfid&#39;)&nbsp;&nbsp; # because obviously these shouldn&#39;t be editable.&nbsp;&nbsp; (but commenting out if want to create some objects from admin just for fun)</span><span class='strut'>&nbsp;</span></p>
<p id='t504' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t505' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>has_delete_permission</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>request</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t506' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot; Don&#39;t display &quot;delete&quot; button &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t507' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>False</span><span class='strut'>&nbsp;</span></p>
<p id='t508' class='stm run hide_run'>&nbsp; &nbsp; <span class='key'>def</span> <span class='nam'>has_add_permission</span><span class='op'>(</span><span class='nam'>self</span><span class='op'>,</span> <span class='nam'>request</span><span class='op'>,</span> <span class='nam'>obj</span><span class='op'>=</span><span class='nam'>None</span><span class='op'>)</span><span class='op'>:</span><span class='strut'>&nbsp;</span></p>
<p id='t509' class='pln'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='str'>&quot;&quot;&quot;Don&#39;t display Save And Add button &quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t510' class='stm run hide_run'>&nbsp; &nbsp; &nbsp; &nbsp; <span class='key'>return</span> <span class='nam'>False</span><span class='strut'>&nbsp;</span></p>
<p id='t511' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t512' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t513' class='pln'><span class='com'># To do, if staff users are able to manage other staff users (not a current use case)</span><span class='strut'>&nbsp;</span></p>
<p id='t514' class='pln'><span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t515' class='pln'><span class='str'>#####################################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t516' class='pln'><span class='str'># Customize User list display, change form fields</span><span class='strut'>&nbsp;</span></p>
<p id='t517' class='pln'><span class='str'>#####################################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t518' class='pln'><span class='str'>class StaffUserAdmin(UserAdmin):</span><span class='strut'>&nbsp;</span></p>
<p id='t519' class='pln'><span class='str'>&nbsp; &nbsp; list_display = (&#39;username&#39;,&#39;first_name&#39;, &#39;last_name&#39;, &#39;email&#39;, &#39;is_superuser&#39;,&#39;is_active&#39;, &#39;is_staff&#39;, &#39;date_joined&#39;,&#39;last_login&#39;,&#39;get_all_permissions&#39;)</span><span class='strut'>&nbsp;</span></p>
<p id='t520' class='pln'><span class='str'>&nbsp; &nbsp; fieldsets = ( </span><span class='strut'>&nbsp;</span></p>
<p id='t521' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; (None&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; { &#39;fields&#39;: ((&#39;username&#39;, &#39;email&#39;), &#39;password&#39;) }),</span><span class='strut'>&nbsp;</span></p>
<p id='t522' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; (None,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { &#39;fields&#39;: ((&#39;first_name&#39;, &#39;last_name&#39;))&nbsp; &nbsp; &nbsp;&nbsp; }),</span><span class='strut'>&nbsp;</span></p>
<p id='t523' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; (None,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { &#39;fields&#39;: (&#39;last_login&#39;, &#39;date_joined&#39;)&nbsp; &nbsp; &nbsp;&nbsp; }),</span><span class='strut'>&nbsp;</span></p>
<p id='t524' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; (&#39;Permissions&#39;, { &#39;fields&#39;: (&#39;is_active&#39;, &#39;is_staff&#39;, &#39;is_superuser&#39;,</span><span class='strut'>&nbsp;</span></p>
<p id='t525' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;user_permissions&#39;) }),</span><span class='strut'>&nbsp;</span></p>
<p id='t526' class='pln'><span class='str'>&nbsp; &nbsp; )&nbsp;&nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t527' class='pln'><span class='str'>&nbsp; &nbsp; add_fieldsets = ( </span><span class='strut'>&nbsp;</span></p>
<p id='t528' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; (None, { &#39;classes&#39;: (&#39;wide&#39;,),</span><span class='strut'>&nbsp;</span></p>
<p id='t529' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &#39;fields&#39;: (&#39;username&#39;, &#39;password1&#39;, &#39;password2&#39;)}),&nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t530' class='pln'><span class='str'>&nbsp; &nbsp; )&nbsp;&nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t531' class='pln'><span class='str'>&nbsp; &nbsp; readonly_fields = (&#39;date_joined&#39;,&#39;last_login&#39;)&nbsp;&nbsp; </span><span class='strut'>&nbsp;</span></p>
<p id='t532' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t533' class='pln'><span class='str'>&nbsp; &nbsp; # Limit permissions shown to *staff* users to: </span><span class='strut'>&nbsp;</span></p>
<p id='t534' class='pln'><span class='str'>&nbsp; &nbsp; # The min perms a non-superuser staff user should have:</span><span class='strut'>&nbsp;</span></p>
<p id='t535' class='pln'><span class='str'>&nbsp; &nbsp; # - lockuser: add, change</span><span class='strut'>&nbsp;</span></p>
<p id='t536' class='pln'><span class='str'>&nbsp; &nbsp; # - manage zero doors</span><span class='strut'>&nbsp;</span></p>
<p id='t537' class='pln'><span class='str'>&nbsp; &nbsp; # - *staff* users: only change own info</span><span class='strut'>&nbsp;</span></p>
<p id='t538' class='pln'><span class='str'>&nbsp; &nbsp; # - access times: *view* only (i.e. change, but can&#39;t *edit* anything on change form... right?)</span><span class='strut'>&nbsp;</span></p>
<p id='t539' class='pln'><span class='str'>&nbsp; &nbsp; # </span><span class='strut'>&nbsp;</span></p>
<p id='t540' class='pln'><span class='str'>&nbsp; &nbsp; # The max perms a non-superuser staff user can have, in addition to above:</span><span class='strut'>&nbsp;</span></p>
<p id='t541' class='pln'><span class='str'>&nbsp; &nbsp; # - doors: add</span><span class='strut'>&nbsp;</span></p>
<p id='t542' class='pln'><span class='str'>&nbsp; &nbsp; # - *staff* users: add, change others</span><span class='strut'>&nbsp;</span></p>
<p id='t543' class='pln'><span class='str'>&nbsp; &nbsp; def get_form(self, request, obj=None, **kwargs):</span><span class='strut'>&nbsp;</span></p>
<p id='t544' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; form = super(StaffUserAdmin,self).get_form(request, obj, **kwargs)</span><span class='strut'>&nbsp;</span></p>
<p id='t545' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t546' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; # only on change, not add (todo)</span><span class='strut'>&nbsp;</span></p>
<p id='t547' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; permissions = form.base_fields[&#39;user_permissions&#39;]</span><span class='strut'>&nbsp;</span></p>
<p id='t548' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t549' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; # maximum permissions</span><span class='strut'>&nbsp;</span></p>
<p id='t550' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; staff_permissions = permissions.queryset.filter(codename__regex=r&#39;add_lockuser|change_lockuser|add_user|change_user|add_door|change_door&#39;)</span><span class='strut'>&nbsp;</span></p>
<p id='t551' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; staff_permissions = staff_permissions | permissions.queryset.filter(codename__regex = &#39;can_manage_door&#39;)</span><span class='strut'>&nbsp;</span></p>
<p id='t552' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; # All door management permissions, except deletion (using reqex because door permissions are created dynamically)</span><span class='strut'>&nbsp;</span></p>
<p id='t553' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; permissions.queryset = staff_permissions</span><span class='strut'>&nbsp;</span></p>
<p id='t554' class='pln'><span class='str'>&nbsp; &nbsp; &nbsp; &nbsp; return form</span><span class='strut'>&nbsp;</span></p>
<p id='t555' class='pln'><span class='str'>&quot;&quot;&quot;</span><span class='strut'>&nbsp;</span></p>
<p id='t556' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t557' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t558' class='pln'><span class='com'>#####################################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t559' class='pln'><span class='com'># Register models</span><span class='strut'>&nbsp;</span></p>
<p id='t560' class='pln'><span class='com'>#####################################################################</span><span class='strut'>&nbsp;</span></p>
<p id='t561' class='pln'><span class='com'>#admin.site.register(Door, DoorAdmin)</span><span class='strut'>&nbsp;</span></p>
<p id='t562' class='pln'><span class='com'>#admin.site.register(RFIDkeycard, RFIDkeycardAdmin)</span><span class='strut'>&nbsp;</span></p>
<p id='t563' class='stm run hide_run'><span class='nam'>admin</span><span class='op'>.</span><span class='nam'>site</span><span class='op'>.</span><span class='nam'>register</span><span class='op'>(</span><span class='nam'>LockUser</span><span class='op'>,</span><span class='nam'>LockUserAdmin</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t564' class='stm run hide_run'><span class='nam'>admin</span><span class='op'>.</span><span class='nam'>site</span><span class='op'>.</span><span class='nam'>register</span><span class='op'>(</span><span class='nam'>AccessTime</span><span class='op'>,</span><span class='nam'>AccessTimeAdmin</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t565' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t566' class='pln'><span class='com'># Register User with UserAdmin. Note that in settings.py, in INSTALLED_APPS,</span><span class='strut'>&nbsp;</span></p>
<p id='t567' class='pln'><span class='com'>#&nbsp;&nbsp; make sure that &#39;django.contrib.auth&#39; appears on the list before the app</span><span class='strut'>&nbsp;</span></p>
<p id='t568' class='pln'><span class='com'>#&nbsp;&nbsp; - this app - that is replacing the default admin.&nbsp; This means that things</span><span class='strut'>&nbsp;</span></p>
<p id='t569' class='pln'><span class='com'>#&nbsp;&nbsp; happen in the right order: first Django registers the User model, then</span><span class='strut'>&nbsp;</span></p>
<p id='t570' class='pln'><span class='com'>#&nbsp;&nbsp; we un-register it here, then we re-register with our own ModelAdmin -</span><span class='strut'>&nbsp;</span></p>
<p id='t571' class='pln'><span class='com'>#&nbsp;&nbsp; User Admin. (If the ordering is wrong, will get error like &quot;The model</span><span class='strut'>&nbsp;</span></p>
<p id='t572' class='pln'><span class='com'>#&nbsp;&nbsp; User is already registered.&quot;)</span><span class='strut'>&nbsp;</span></p>
<p id='t573' class='pln'><span class='com'>#admin.site.register(User, UserAdmin)</span><span class='strut'>&nbsp;</span></p>
<p id='t574' class='pln'><span class='com'>#admin.site.unregister(User)</span><span class='strut'>&nbsp;</span></p>
<p id='t575' class='pln'><span class='com'>#admin.site.register(User, StaffUserAdmin)</span><span class='strut'>&nbsp;</span></p>
<p id='t576' class='pln'><span class='strut'>&nbsp;</span></p>
<p id='t577' class='pln'><span class='com'># Globally disable deletion of selected objects (i.e this will not be an available action in the Actions dropdown of</span><span class='strut'>&nbsp;</span></p>
<p id='t578' class='pln'><span class='com'># all ModelAdmins/change_list pages.</span><span class='strut'>&nbsp;</span></p>
<p id='t579' class='stm run hide_run'><span class='nam'>admin</span><span class='op'>.</span><span class='nam'>site</span><span class='op'>.</span><span class='nam'>disable_action</span><span class='op'>(</span><span class='str'>&#39;delete_selected&#39;</span><span class='op'>)</span><span class='strut'>&nbsp;</span></p>
<p id='t580' class='pln'><span class='com'># Although might want to be able to delete Doors</span><span class='strut'>&nbsp;</span></p>
                
            </td>
        </tr>
    </table>
</div>

<div id='footer'>
    <div class='content'>
        <p>
            <a class='nav' href='index.html'>&#xab; index</a> &nbsp; &nbsp; <a class='nav' href='http://nedbatchelder.com/code/coverage'>coverage.py v3.6</a>
        </p>
    </div>
</div>

</body>
</html>
